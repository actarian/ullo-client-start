{"version":3,"sources":["wwwroot/js/app.js"],"names":["app","angular","module","animation","$rootScope","$animate","isFirstView","currentRoute","isBackward","previousRoute","isForward","bezierOptions","type","dynamics","bezier","points","x","y","cp","duration","$on","event","current","previous","$$route","enter","element","done","css","translateY","opacity","scale","animate","w","offsetWidth","translateX","leave","setTimeout","LESSON","CONFIG","CLIENT","window","location","href","indexOf","API","FACEBOOK_APP_ID","assetTypeEnum","Unknown","Picture","IOS","navigator","userAgent","match","constant","config","$routeProvider","$locationProvider","when","title","templateUrl","controller","controllerAs","resolve","user","Users","isLoggedOrGoTo","otherwise","html5Mode","$httpProvider","defaults","withCredentials","$scope","$timeout","$http","$location","model","input2Options","name","id","get","then","response","data","error","console","log","signin","signinFormError","signinFormBusy","clicked","post","success","path","message","label","item","userName","facebookId","route","dish","price","isVeganFriendly","yes","no","created","vote","dishId","like","categories","key","picture","guid","loadStream","items","$q","FacebookService","signOut","logoutBusy","all","signout","logout","goStream","goPost","goDish","goCategory","categoryId","goUser","userRoute","goSettings","$window","signinOrSignup","auth","splashBusy","signInWithFacebook","useFacebook","getLoginStatus","authResponse","showFacebookLoginButton","showLoginButton","onFacebookLogin","login","onLogin","getFacebookMe","me","email","firstName","first_name","lastName","last_name","facebookPicture","url","facebookToken","accessToken","signup","signupFormError","signupFormBusy","DataSource","Posts","Upload","filters","search","source","service","paging","onUploadFileSelected","file","newFiles","$root","pictureBase64","dataUrl","Categories","DishesAutocomplete","dishesAutocomplete","hasPicture","has","pictureError","onDishSelected","submitPost","postFormBusy","postFormError","add","status","statusText","$routeParams","Dishes","detail","category","Category","UserName","currentUser","DishesTest","directive","link","scope","attributes","draw","time","d","Math","PI","ctx","clearRect","canvas","width","height","fillStyle","i","g","fillRect","sin","cos","play","loop","aKey","requestAnimationFrame","pause","cancelAnimationFrame","playpause","onDown","e","addListeners","on","removeListeners","off","offsetHeight","getContext","onTap","addClass","removeClass","restrict","delays","undefined","split","delay","forEach","parseInt","length","push","removeClasses","join","shift","a","$parse","$compile","Utils","transclude","template","doTop","busy","onTop","$apply","sy","ey","undrag","doBottom","onBottom","lbottom2","inner","lbottom","padding","dragging","wheeling","move","down","removeDragListeners","bounce","ltop","redraw","speed","abs","cy","min","max","innerStyle","transform","toFixed","set","showIndicatorFor","percent","iy","indicator","ix","round","rows","html","count","indicatorStyle","getTouch","addDragListeners","onMove","prev","onUp","up","_onWheel","dir","deltaY","wheelDelta","onWheel","ondragstart","$eval","find","Style","append","contents","throttle","src","ngImg","image","Image","onload","$set","this","load","$watch","newValue","WebWorker","worker","doWork","onImageLoaded","ngImgWorker","replace","form","placeholder","formKey","formFocus","required","readonly","control","options","number","canCreate","flatten","queryable","onSelected","MAX_ITEMS","getPhrase","Clear","phrase","input","val","Current","active","onTyping","Enter","onSelect","Up","Down","Parse","value","index","toLowerCase","NameA","substr","NameB","NameC","Filter","c","Search","setPhrase","onKeyDown","keyCode","preventDefault","onKeyUp","call","getClosest","target","onBlur","Init","init","maxItems","Number","POSITIVE_INFINITY","onFocus","$parent","setItem","parsedItem","$item","$event","extend","$watchCollection","require","validateType","$parsers","unshift","$setValidity","String","toString","filter","$filter","legacyFilter","cost","currency","ratio","formatting","APP","inches","unit","units","IMPERIAL","feet","floor","meters","size","cm","pounds","oz","kg","weight","grams","precision","format","timezone","parseTime","parseHour","Guest","User","Supervisor","Admin","factory","UserRolesEnum","prototype","isAdmin","role","isUser","backgroundPicture","onFacebookStatus","deferred","reject","FB","defer","promise","facebook","api","fields","getPictureMe","deletePermissions","fbAsyncInit","appId","cookie","xfbml","version","s","js","fjs","getElementsByTagName","getElementById","createElement","parentNode","insertBefore","document","LocalStorage","_currentUser","getCurrentUser","isLogged","isAuthenticated","redirect","isAdminOrGoTo","Dish","getRandomItems","uniqueId","random","pictures","TestSource","uri","Post","v","offset","DataFilter","getSearchParams","p","getParams","infinite","JSON","stringify","page","$httpAsync","maxPages","pages","pagination","getPages","$broadcast","bind","flush","PAGES_MAX","opened","responseHeader","headers","responseView","parse","params","refresh","more","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","Cookie","TIMEOUT","_set","days","date","Date","setTime","getTime","expires","toGMTString","cache","json","cookieName","ca","charAt","substring","checkCookie","elapsed","timeout","interval","isLocalStorageSupported","supported","localStorage","removeItem","isSupported","storageEvent","clearTimeout","originalEvent","Vector","make","b","sqrt","normalize","l","incidence","angle","atan2","distance","cross","difference","towards","friction","copy","t","touch","touches","changedTouches","pageX","pageY","getRelativeTouch","point","rect","getBoundingClientRect","left","top","el","selector","matchesFn","parent","some","fn","body","parentElement","func","wait","context","args","result","later","leading","getNow","apply","now","remaining","arguments","trailing","lastTime","vendors","callback","currTime","timeToCall","transformProperty","safariPropertyHack","div","style","every","prefix","props","hoverScale","currentScale","styles","cssText","transformOrigin","self","callbacks","Worker","onmessage","isWebWorkerSupported","transformResponse","h","eval","object","o","postMessage","wrap","getDefaults","isSuccess","createMap","Object","create","isString","parseHeaders","fillInParsed","parsed","j","line","lowercase","trim","isObject","headersGetter","headersObj","method","responseType","common","string","head","put","patch","getter"],"mappings":"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","file":"wwwroot/js/app.min.js","sourcesContent":["/*global angular,FB */\r\n\r\nvar app = angular.module('ullo', ['ngRoute', 'ngAnimate', 'ngMessages']);\r\n\r\n/*\r\napp.config(['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {\r\n\r\n\t$routeProvider.when('/', {                \r\n        controller: 'SignInCtrl',\r\n        templateUrl: 'templates/signin-test.html',\r\n        title: 'Sign In',        \r\n        \r\n    }).when('/signin', {                \r\n        controller: 'SignInCtrl',\r\n        templateUrl: 'templates/signin-test.html',\r\n        title: 'Sign In',\r\n        \r\n    }).when('/stream', {        \r\n        controller: 'TestCtrl',\r\n        templateUrl: 'templates/test.html',\r\n        title: 'TestCtrl',\r\n        isForward: true\r\n        \r\n    }).when('/dishes/:dishId', {        \r\n        controller: 'TestCtrl',\r\n        templateUrl: 'templates/test.html',\r\n        title: 'Dishes',\r\n        \r\n    }).when('/test', {                \r\n        controller: 'TestCtrl',\r\n        templateUrl: 'templates/temp.html',\r\n        title: 'HomePage',\r\n        \r\n    }).when('/404', {\r\n        controller: 'TestCtrl',\r\n        templateUrl: 'templates/test.html',\r\n        title: 'Errore 404',\r\n        isForward: true\r\n        \r\n    });\r\n    \r\n    $routeProvider.otherwise('/404');\r\n    \r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(true);\r\n    \r\n}]);\r\n*/\r\n\n/*global angular,dynamics*/\r\n\r\napp.animation('.navigation', ['$rootScope', '$animate', function($rootScope, $animate) {\r\n    \r\n    var previousRoute = null;\r\n    var currentRoute = null;\r\n    var bezierOptions = {\r\n        type: dynamics.bezier,\r\n        points: [{ x: 0, y: 0, cp: [{ x: 0.509, y: 0.007 }] }, { x: 1, y: 1, cp: [{ x: 0.566, y: 0.997 }] }],\r\n        duration: 500,\r\n    }\r\n    \r\n    $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        previousRoute = previous.$$route;\r\n        currentRoute = current.$$route;\r\n    });\r\n    \r\n    function isFirstView() {\r\n        return !currentRoute;\r\n    }\r\n    function isBackward() {\r\n        return previousRoute && previousRoute.isForward;\r\n    }\r\n    return {\r\n        enter: function(element, done) {\r\n            if (isFirstView()) {\r\n                // FIRST ENTERING ANIMATION\r\n                dynamics.css(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 0,\r\n                    scale: 1.2,\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 1,\r\n                    scale: 1,\r\n                }, bezierOptions);\r\n            } else if (isBackward()) {\r\n                // BACKWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: -w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions);\r\n            } else {\r\n                // FORWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions);\r\n            }\r\n            done();\r\n        },\r\n        leave: function(element, done) {\r\n            if (isBackward()) {\r\n                // BACKWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: w\r\n                }, bezierOptions);\r\n            } else {\r\n                // FORWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: -w\r\n                }, bezierOptions);\r\n            }\r\n            setTimeout(done, 1000);\r\n        }\r\n    }\r\n}]);\n/*global angular,FB */\n\nvar LESSON = true;\nvar CONFIG = {\n    CLIENT: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? 'http://ulloclient.wslabs.it' : 'http://dev.ullowebapp:8081',\n    API: (LESSON || window.location.href.indexOf('http://ulloclient.wslabs.it') === 0) ? 'http://ulloapi.wslabs.it' : 'https://localhost:44302',\n    FACEBOOK_APP_ID: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? '1054303094614120' : '1062564893787940',\n    assetTypeEnum: {\n        Unknown: 0,\n        Picture: 1,\n    },\n    IOS: (navigator.userAgent.match(/iPad|iPhone|iPod/g) ? true : false),\n};\n\napp.constant('APP', CONFIG);\n\napp.config(['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {\n\n    // UNSECURE ROUTING\n    $routeProvider.when('/splash', {\n        title: 'Splash',\n        templateUrl: 'templates/splash.html',\n        controller: 'SplashCtrl',\n        controllerAs: 'splashCtrl',\n\n    }).when('/test', {\n        title: 'Test',\n        templateUrl: 'templates/test.html',\n        controller: 'StreamTestCtrl',\n        controllerAs: 'testCtrl',\n\n    }).when('/stream-test', {\n        title: 'Stream Test',\n        templateUrl: 'templates/test.html',\n        controller: 'StreamTestCtrl',\n        controllerAs: 'testCtrl',\n\n    }).when('/signin-test', {\n        title: 'Sign In',\n        templateUrl: 'templates/signin-test.html',\n        controller: 'SignInTestCtrl',\n        controllerAs: 'signinCtrl',\n    }).when('/signin', {\n        title: 'Sign In',\n        templateUrl: 'templates/signin.html',\n        controller: 'SigninCtrl',\n        controllerAs: 'signinCtrl',\n\n    }).when('/signup', {\n        title: 'Sign Up',\n        templateUrl: 'templates/signup.html',\n        controller: 'SignupCtrl',\n        controllerAs: 'signupCtrl',\n\n    }).when('/404', {\n\n        title: 'Error 404',\n        templateUrl: '404.html',\n\n    // SECURE ROUTING\n    }).when('/stream', {\n        title: 'Stream',\n        templateUrl: 'templates/stream.html',\n        controller: 'StreamCtrl',\n        controllerAs: 'streamCtrl',\n        resolve: {\n            user: ['Users', function(Users){\n                return Users.isLoggedOrGoTo('/splash');\n            }]\n        },\n\n    }).when('/dishes/:dishId', {\n        title: 'Dish',\n        templateUrl: 'templates/dish.html',\n        controller: 'DishCtrl',\n        controllerAs: 'dishCtrl',\n        resolve: {\n            user: ['Users', function(Users){\n                return Users.isLoggedOrGoTo('/splash');\n            }]\n        },\n        isForward: true,\n\n    }).when('/categories/:categoryId', {\n        title: 'Category',\n        templateUrl: 'templates/category.html',\n        controller: 'CategoryCtrl',\n        controllerAs: 'categoryCtrl',\n        resolve: {\n            user: ['Users', function(Users){\n                return Users.isLoggedOrGoTo('/splash');\n            }]\n        },\n        isForward: true,\n\n    }).when('/users/:userRoute', {\n        title: 'User',\n        templateUrl: 'templates/user.html',\n        controller: 'UserCtrl',\n        controllerAs: 'userCtrl',\n        resolve: {\n            user: ['Users', function(Users){\n                return Users.isLoggedOrGoTo('/splash');\n            }]\n        },\n        isForward: true,\n\n    }).when('/post', {\n        title: 'Add Post',\n        templateUrl: 'templates/post.html',\n        controller: 'PostCtrl',\n        controllerAs: 'postCtrl',\n        resolve: {\n            user: ['Users', function(Users){\n                return Users.isLoggedOrGoTo('/splash');\n            }]\n        },\n        isForward: true,\n\n    }).when('/settings', {\n        title: 'Settings',\n        templateUrl: 'templates/settings.html',\n        controller: 'SettingsCtrl',\n        controllerAs: 'settingsCtrl',\n        resolve: {\n            user: ['Users', function(Users){\n                return Users.isLoggedOrGoTo('/splash');\n            }]\n        },\n        isForward: true,\n\n    });\n\n    $routeProvider.otherwise('/stream');\n\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\n    $locationProvider.html5Mode(true);\n\n}]);\n\napp.config(['$httpProvider', function ($httpProvider) {\n    \n    $httpProvider.defaults.withCredentials = true;\n    \n}]);\n\n/*global angular,FB */\n\napp.controller('SignInTestCtrl', ['$scope', '$timeout', '$http', '$location', function ($scope, $timeout, $http, $location) {\n\n    $scope.model = {};\n\n    $scope.input2Options = [{\n        name: 'Option1',\n        id:1   \n    }, {\n        name: 'Option2',\n        id:2   \n    }]\n    \n    $http.get('http://ulloapi.wslabs.it/api/stream/anonymous').then(function(response){\n        $scope.input2Options = response.data;\n    }, function(error) {\n        console.log('error', error);\n    });\n\n    $scope.signin = function () {\n        $scope.signinFormError = null;\n        $scope.signinFormBusy = true;\n        $scope.clicked = true;\n        $timeout(function() {\n            $http.post('http://ulloapi.wslabs.it/api/users/signin', $scope.model).then(function(success) {\n                console.log('signin', success);\n                $location.path('/stream-test');\n            }, function(error) {\n                console.log('error', error);\n                $scope.signinFormError = { message: error.message };\n            }).finally(function() {\n                $timeout(function() {\n                    $scope.signinFormBusy = false;\n                }, 3000);\n            });\n            $scope.clicked = false;\n        }, 1000);\n    };\n    \n}]);\n    \napp.controller('StreamTestCtrl', ['$scope', '$timeout', '$http', function ($scope, $timeout, $http) {\n\n    $scope.model = {\n        label: 'Carica',\n    };\n        \n    setTimeout(function() {\n        $scope.model.label = 'Carica Stream';\n    }, 1000);\n\n    $scope.item = {\n        id: 117,\n        user: {\n            userName: 'Fabio Ottaviani',\n            facebookId: '10153341954226947',\n            route: 'fabio-ottaviani'\n        },\n        dish: {\n            price: 5,\n            isVeganFriendly: false,\n            yes: 1,\n            no: 0,\n            created: '2016-04-27T19:13:45.497',\n            vote: {\n                dishId: 19,\n                like: true,\n                created: '2016-04-27T19:14:00.497'\n            },\n            categories: [\n                {\n                    id: 2,\n                    name: 'Piadine',\n                    key: 'piadine'\n                }\n            ],\n            id: 19,\n            name: 'Pizza Margherita',\n            key: 'pizzaMargherita'\n        },\n        picture: {\n            guid: '8fe99743-4ed3-46de-ba13-2c1bd7a45ffe',\n            created: '2016-04-27T19:13:41.02',\n            id: 20,\n            name: '8fe99743-4ed3-46de-ba13-2c1bd7a45ffe',\n            route: '/Media/Files/8fe99743-4ed3-46de-ba13-2c1bd7a45ffe.jpg',\n            key: '8Fe997434Ed346DeBa132C1bd7a45ffe'\n        },\n        created: '2016-04-27T19:13:45.497'\n    };\n    \n    $scope.loadStream = function() {\n        $http.get('http://ulloapi.wslabs.it/api/stream/anonymous').then(function(response){\n            $scope.items = response.data;\n        }, function(error) {\n            console.log('error', error);\n        });\n    };\n\n}]);\n\napp.controller('RootCtrl', ['$scope', '$location', '$q', 'FacebookService', 'Users', function ($scope, $location, $q, FacebookService, Users) {\n\n    $scope.Users = Users;\n\n    $scope.signOut = function () {\n        if ($scope.logoutBusy) {\n            return;\n        }\n\t\t$scope.logoutBusy = true;\n\t\t$q.all([\n\t\t\tUsers.signout(),\n\t\t\tFacebookService.logout()\n\t\t]).then(function(data) {\n\t\t\t$location.path('/splash');\n\t\t}, function(error) {\n\t\t\tconsole.log('signOut.error', error);\n\t\t}).finally(function() {\n\t\t\t$scope.logoutBusy = false;\n\t\t});\n    };\n\n    $scope.goStream = function () {\n        $location.path('/stream');\n    };\n\n    $scope.goPost = function () {\n        $location.path('/post');\n    };\n\n    $scope.goDish = function (dishId) {\n        $location.path('/dishes/' + dishId);\n    };\n\n    $scope.goCategory = function (categoryId) {\n        $location.path('/categories/' + categoryId);\n    };\n\n    $scope.goUser = function (userRoute) {\n        $location.path('/users/' + userRoute);\n    };\n\n    $scope.goSettings = function () {\n        $location.path('/settings');\n    };\n\n}]);\n\napp.controller('SplashCtrl', ['$scope', '$location', '$timeout', '$window', 'FacebookService', 'Users', function ($scope, $location, $timeout, $window, FacebookService, Users) {\n\n    var useFacebook = false;\n\n    $scope.splashBusy = true;\n\n\t$timeout(function() {\n        if (useFacebook) {\n            FacebookService.getLoginStatus().then(function(success) {\n                console.log('SplashCtrl.getLoginStatus.success', success.authResponse);\n                signinOrSignup(success.authResponse);\n\n            }, function(error) {\n                console.log('SplashCtrl.getLoginStatus.error', error);\n                $scope.showFacebookLoginButton = true;\n\n            }).finally(function() {\n                $scope.splashBusy = false;\n            });\n        } else {\n            $scope.showLoginButton = true;\n            $scope.splashBusy = false;\n        }\n\t}, 1000);\n\n    function signinOrSignup(auth) {\n        $scope.splashBusy = true;\n        Users.signInWithFacebook(auth).then(function(success) {\n            $location.path('/stream');\n        }, function(error) {\n            $location.path('/signup');\n        }).finally(function() {\n            $scope.splashBusy = false;\n        });\n    }\n\n    $scope.onFacebookLogin = function() {\n        $scope.splashBusy = true;\n        FacebookService.login().then(function(success) {\n            signinOrSignup(success.authResponse);\n        }, function(error) {\n            console.log('onFacebookLogin', error);\n        }).finally(function() {\n            $scope.splashBusy = false;\n        });\n    };\n\n    $scope.onLogin = function() {\n        $location.path('/signin');\n    };\n\n}]);\n\napp.controller('SigninCtrl', ['$scope', '$location', 'Users', 'FacebookService', function ($scope, $location, Users, FacebookService) {\n\n    $scope.model = {};\n\n    $scope.signin = function () {\n        $scope.signinFormError = null;\n        $scope.signinFormBusy = true;\n        Users.signin($scope.model).then(function (user) {\n            $location.path('/stream');\n        }, function (error) {\n            $scope.signinFormError = error.message;\n        }).finally(function () {\n            $scope.signinFormBusy = false;\n        });\n    };\n\n}]);\n\napp.controller('SignupCtrl', ['$scope', '$location', 'FacebookService', 'Users', function ($scope, $location, FacebookService, Users) {\n\n    FacebookService.getFacebookMe().then(function(me) {\n        console.log('SignupCtrl.getFacebookMe', me);\n        $scope.model = {\n            userName : me.name,\n            email : me.email,\n            firstName : me.first_name,\n            lastName : me.last_name,\n            facebookId : me.id,\n            facebookPicture : me.picture.data.url,\n            facebookToken : FacebookService.authResponse.accessToken,\n        };\n    }, function(error) {\n        console.log('SignupCtrl.getFacebookMe.error', error);\n    });\n\n    $scope.signup = function () {\n        console.log('SignupCtrl.signup', $scope.model);\n        $scope.signupFormError = null;\n        $scope.signupFormBusy = true;\n        Users.signup($scope.model).then(function (user) {\n            $location.path('/stream');\n        }, function (error) {\n            $scope.signupFormError = error.data.message;\n        }).finally(function () {\n            $scope.signupFormBusy = false;\n        });\n    };\n\n}]);\n\napp.controller('StreamCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'Posts', 'Upload', function ($scope, $location, $timeout, DataSource, Posts, Upload) {\n\n    $scope.filters = {\n        search: {\n        }\n    };\n\n    $scope.source = new DataSource({\n        service: Posts,\n        filters: $scope.filters\n    });\n\n    $scope.source.paging();\n\n    $scope.onUploadFileSelected = function(file, newFiles) {\n        if (!file) {\n            return;\n        }\n        $scope.$root.pictureBase64 = null;\n        Upload.dataUrl(file, true).then(function (url) {\n            $scope.$root.pictureBase64 = url;\n            $location.path('/post');\n        });\n    };\n\n}]);\n\napp.controller('PostCtrl', ['$scope', '$timeout', '$location', 'Upload', 'Categories', 'Posts', 'DishesAutocomplete', function ($scope, $timeout, $location, Upload, Categories, Posts, DishesAutocomplete) {\n\n    Categories.get().then(function(categories) {\n        $scope.categories = categories;\n    })\n\n    $scope.dishesAutocomplete = new DishesAutocomplete();\n\n    $scope.model = {\n        pictureBase64: $scope.$root.pictureBase64 || null,\n        dish: {\n            categories: [],\n        }\n    };\n\n    $scope.onUploadFileSelected = function(file, newFiles) {\n        $scope.model.pictureBase64 = null;\n        Upload.dataUrl(file, true).then(function (url) {\n            $scope.model.pictureBase64 = url;\n        });\n    };\n\n    $scope.hasPicture = function () {\n        var has = $scope.model.pictureBase64 !== null;\n        $scope.pictureError = true;\n        $timeout(function () {\n            $scope.pictureError = false;\n        }, 1000);\n        return has;\n    };\n\n    $scope.onDishSelected = function(item) {\n        console.log('onDishSelected', item);\n        $scope.model.dish.id = item.id;\n        $scope.model.dish.price = item.price;\n        $scope.model.dish.categories = item.categories;\n        $scope.model.dish.isVeganFriendly = item.isVeganFriendly;\n    };\n\n    $scope.submitPost = function () {\n        console.log('PostCtrl.submitPost', $scope.model);\n        $scope.postFormBusy = true;\n        $scope.postFormError = null;\n        $timeout(function () {\n            Posts.add($scope.model).then(function(post) {\n                $scope.model.id = post.id;\n                $location.path('/stream');\n            }, function(error) {\n                $scope.postFormError = error.config.url + ' ' + error.status + ' ' + error.statusText;\n            }).finally(function(){\n                $scope.postFormBusy = false;\n            });\n        }, 1);\n    };\n\n}]);\n\napp.controller('DishCtrl', ['$scope', '$routeParams', 'Dishes', function ($scope, $routeParams, Dishes) {\n\n    Dishes.detail($routeParams.dishId).then(function(item) {\n       $scope.item = item;\n    });\n\n}]);\n\napp.controller('CategoryCtrl', ['$scope', '$routeParams', 'Categories', 'DataSource', 'Dishes', function ($scope, $routeParams, Categories, DataSource, Dishes) {\n\n    Categories.detail($routeParams.categoryId).then(function(category) {\n       $scope.category = category;\n\n       $scope.filters = {\n            search: {\n                Category: category.name\n            }\n        };\n\n        $scope.source = new DataSource({\n            service: Dishes,\n            filters: $scope.filters\n        });\n\n        $scope.source.paging();\n\n    });\n\n}]);\n\napp.controller('UserCtrl', ['$scope', '$routeParams', 'Users', 'DataSource', 'Dishes', function ($scope, $routeParams, Users, DataSource, Dishes) {\n\n    Users.detail($routeParams.userRoute).then(function(user) {\n       $scope.user = user;\n\n       $scope.filters = {\n            search: {\n                UserName: user.userName\n            }\n        };\n\n        $scope.source = new DataSource({\n            service: Dishes,\n            filters: $scope.filters\n        });\n\n        $scope.source.paging();\n\n    });\n\n}]);\n\napp.controller('SettingsCtrl', ['$scope', '$routeParams', 'Users', function ($scope, $routeParams, Users) {\n\n    $scope.user = Users.currentUser();\n\n}]);\n\napp.controller('DishTestCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'DishesTest', function ($scope, $location, $timeout, DataSource, DishesTest) {\n\n    $scope.filters = {\n        search: {\n        }\n    };\n\n    $scope.source = new DataSource({\n        service: DishesTest,\n        filters: $scope.filters\n    });\n\n    $timeout(function() {\n        $scope.source.paging();\n    }, 1000);\n\n}]);\n\n/*global angular,FB,dynamics*/\r\n\r\napp.directive('backgroundSplash', ['$timeout', function ($timeout) {\r\n    return {\r\n        link: function (scope, element, attributes, model) {\r\n            var canvas = element[0];\r\n            canvas.width = canvas.offsetWidth;\r\n            canvas.height = canvas.offsetHeight;\r\n            var ctx = canvas.getContext('2d');\r\n\r\n            var aKey;\r\n            function draw(time) {\r\n                var d = time / 1000 % (Math.PI * 2);\r\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n                ctx.fillStyle = \"white\";\r\n                for(var i = 0; i < 50; i++) {\r\n                    var g = Math.PI * 2 / 50 * i;\r\n                    ctx.fillRect(canvas.width / 2 + 100 * Math.sin(g + d), canvas.height / 2 + 100 * Math.cos(g + d), 4, 4);\r\n                }\r\n            }\r\n            function play() {\r\n                function loop(time) {\r\n                    draw(time);\r\n                    aKey = window.requestAnimationFrame(loop, element);\r\n                }\r\n                if (!aKey) {\r\n                    loop();\r\n                }\r\n            }\r\n            function pause() {\r\n                if (aKey) {\r\n                    window.cancelAnimationFrame(aKey);\r\n                    aKey = null;\r\n                    // console.log('Animation.paused');\r\n                }\r\n            }\r\n            function playpause() {\r\n                if (aKey) {\r\n                    pause();\r\n                } else {\r\n                    play();\r\n                }\r\n            }\r\n            \r\n            function onDown(e) {\r\n                console.log('onDown');\r\n                playpause();\r\n            }\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onDown);\r\n            }\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onDown);\r\n            }\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n            play();\r\n        }\r\n    }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name onTap\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'tapped' on element and removes it after a timeout of 500 ms\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <button type=\"button\" on-tap>Tap me!</button>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .tapped {\r\n            background: red;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('onTap', ['$timeout', function ($timeout) {\r\n    return {\r\n        link: function (scope, element, attributes, model) {\r\n            function onTap(e) {\r\n                console.log(attributes);\r\n                element.addClass('tapped');\r\n                $timeout(function () {\r\n                    element.removeClass('tapped');\r\n                }, 500)\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name animate\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'animated' on element\r\n   *\r\n   * @param {string} [animate=fadeIn] a comma separated animate.css class names\r\n   * @param {string} [delay=1] a comma separated durations list in milliseconds\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div type=\"button\" animate=\"fadeInUp\" delay=\"1000\">\r\n            I'm an animated div.\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('animate', ['$timeout', function ($timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            element.addClass('animated');\r\n            var animate = ['fadeIn'], delays = ['1'];\r\n            if (attributes.animate !== undefined) {\r\n                animate = attributes.animate.split(',');\r\n            }\r\n            if (attributes.delay !== undefined) {\r\n                delays = attributes.delay.split(',');\r\n            }\r\n            angular.forEach(delays, function (d, i) {\r\n                delays[i] = parseInt(d);\r\n            });\r\n            while (delays.length < animate.length) {\r\n                delays.push(delays[delays.length - 1] + 50);\r\n            }\r\n            var removeClasses = animate.join(' ');\r\n            if (animate[0].indexOf('In') !== -1) {\r\n                element.addClass('invisible');\r\n                removeClasses += ' invisible';\r\n            }\r\n            while (animate.length) {\r\n                var d = delays.shift();\r\n                var a = animate.shift();\r\n                $timeout(function () {\r\n                    element.removeClass(removeClasses);\r\n                    element.addClass(a);\r\n                    if (animate.length === 0 && a.indexOf('Out') !== -1) {\r\n                        $timeout(function () {\r\n                            element.addClass('invisible');\r\n                        }, 1000);\r\n                    }\r\n                }, d);\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name scrollable\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Scrollable div 3d accellerated with touch functionality and callbacks for infinite scroll\r\n   *\r\n   * @param {promise} [on-top] optional callback function that execute when reaching top\r\n   * @param {promise} [on-bottom] optional callback function that execute when reaching bottom\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div ng-controller=\"TestCtrl\">\r\n            <section scrollable on-top=\"$root.doRefresh()\">\r\n                <ul>\r\n                    <li ng-repeat=\"item in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]\">item <span ng-bind=\"item\"></span></li>\r\n                </ul>\r\n            </section>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.controller('TestCtrl', ['$scope', '$q', function($scope, $q) {\r\n            $scope.doRefresh = function() {\r\n               var deferred = $q.defer();\r\n               if ($scope.busy) {\r\n                  deferred.reject();\r\n               } else {\r\n                  $scope.busy = true;\r\n                  $timeout(function() {\r\n                     $scope.busy = false;\r\n                     deferred.resolve();\r\n                  }, 500);\r\n               }\r\n               return deferred.promise;\r\n            };\r\n         }]);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .scrollable.content {\r\n            height: 200px!important;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('scrollable', ['$parse', '$compile', '$window', '$timeout', 'Utils', function ($parse, $compile, $window, $timeout, Utils) {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        template: '<div class=\"inner unselectable\" unselectable=\"on\" ng-transclude></div>',\r\n        link: function (scope, element, attributes, model) {\r\n            $window.ondragstart = function () { return false; };\r\n            // CONSTS;\r\n            var padding = 150;\r\n            // FLAGS;\r\n            var dragging, wheeling, busy;\r\n            // MOUSE;\r\n            var down, move, prev, up;\r\n            // COORDS;\r\n            var sy = 0, ey = 0, cy = 0, ltop = 0, lbottom = 0, speed = 0, ix = 45, iy = 0;\r\n            // ANIMATION KEY;\r\n            var aKey;\r\n            var onTop, onBottom, showIndicatorFor;\r\n            if (attributes.onTop !== undefined) {\r\n                onTop = $parse(attributes.onTop, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            if (attributes.onBottom !== undefined) {\r\n                onBottom = $parse(attributes.onBottom, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            if (attributes.showIndicatorFor !== undefined) {\r\n                showIndicatorFor = scope.$eval(attributes.showIndicatorFor); // $parse(attributes.showIndicatorFor, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            // console.log('showIndicatorFor', showIndicatorFor);\r\n            // ELEMENTS & STYLESHEETS;\r\n            element.addClass('scrollable content');            \r\n            // element.attr('unselectable', 'on').addClass('unselectable');\r\n            var inner = element.find('div');\r\n            var innerStyle = new Utils.Style();\r\n            var indicator = null, indicatorStyle;\r\n            if (showIndicatorFor) {\r\n                indicator = angular.element('<div class=\"indicator\"></div>');\r\n                indicatorStyle = new Utils.Style();\r\n                element.append(indicator);\r\n                $compile(indicator.contents())(scope);\r\n                indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n                indicatorStyle.set(indicator[0]);\r\n            }\r\n            function doTop() {\r\n                if (busy) {\r\n                    return;\r\n                }\r\n                if (!onTop) {\r\n                    return;\r\n                }\r\n                busy = true;\r\n                scope.$apply(onTop).then().finally(function () {\r\n                    sy = ey = 0;\r\n                    setTimeout(function () {\r\n                        undrag();\r\n                        busy = false;\r\n                    }, 500);\r\n                });\r\n            }\r\n            function doBottom() {\r\n                if (busy) {\r\n                    return;\r\n                }\r\n                if (!onBottom) {\r\n                    return;\r\n                }\r\n                busy = true;\r\n                scope.$apply(onBottom).then().finally(function () {\r\n                    var lbottom2 = element[0].offsetHeight - inner[0].offsetHeight;\r\n                    if (lbottom2 > lbottom) {\r\n                        sy = ey = lbottom;\r\n                    } else {\r\n                        sy = ey = lbottom + padding;\r\n                    }\r\n                    setTimeout(function () {\r\n                        undrag();\r\n                        busy = false;\r\n                    }, 500);\r\n                });\r\n            }\r\n            function undrag() {\r\n                // console.log('undrag');\r\n                dragging = false;\r\n                wheeling = false;\r\n                move = null;\r\n                down = null;\r\n                removeDragListeners();\r\n            }\r\n            function bounce() {\r\n                ltop += padding;\r\n                lbottom -= padding;\r\n                if (ey > ltop) {\r\n                    doTop();\r\n                } else if (ey < lbottom) {\r\n                    doBottom();\r\n                }\r\n            }\r\n            function redraw(time) {\r\n                // if (!busy) {\r\n                ltop = 0;\r\n                lbottom = element[0].offsetHeight - inner[0].offsetHeight;\r\n                if (dragging) {\r\n                    ey = sy + move.y - down.y;\r\n                    bounce();\r\n                } else if (speed) {\r\n                    ey += speed;\r\n                    speed *= .75;\r\n                    if (wheeling) {\r\n                        bounce();\r\n                    }\r\n                    if (Math.abs(speed) < 0.05) {\r\n                        speed = 0;\r\n                        ey = sy = cy;\r\n                        wheeling = false;\r\n                        pause();\r\n                    }\r\n                }\r\n                // }\r\n                ey = Math.min(ltop, ey);\r\n                ey = Math.max(lbottom, ey);\r\n                cy += (ey - cy) / 4;\r\n                innerStyle.transform('translate3d(0,' + cy.toFixed(2) + 'px,0)');\r\n                innerStyle.set(inner[0]);\r\n                if (showIndicatorFor) {\r\n                    if (dragging || wheeling || speed) {\r\n                        var percent = cy / (element[0].offsetHeight - inner[0].offsetHeight);\r\n                        percent = Math.max(0, Math.min(1, percent));\r\n                        iy = (element[0].offsetHeight - indicator[0].offsetHeight) * (percent);\r\n                        ix += (0 - ix) / 4;\r\n                        // var count = Math.round(inner[0].offsetHeight / 315);\r\n                        var i = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\r\n                        indicator.html(i + '/' + showIndicatorFor.count);\r\n                        // indicator.html((percent * 100).toFixed(2).toString());\r\n                    } else {\r\n                        ix += (45 - ix) / 4;\r\n                    }\r\n                    indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n                    indicatorStyle.set(indicator[0]);\r\n                }\r\n            }\r\n            function play() {\r\n                function loop(time) {\r\n                    redraw(time);\r\n                    aKey = window.requestAnimationFrame(loop, element);\r\n                }\r\n                if (!aKey) {\r\n                    loop();\r\n                }\r\n            }\r\n            function pause() {\r\n                if (aKey) {\r\n                    window.cancelAnimationFrame(aKey);\r\n                    aKey = null;\r\n                    // console.log('Animation.paused');\r\n                }\r\n            }\r\n            function onDown(e) {\r\n                if (!busy) {\r\n                    sy = ey = cy;\r\n                    speed = 0;\r\n                    down = Utils.getTouch(e);\r\n                    wheeling = false;\r\n                    // console.log(down);\r\n                    addDragListeners();\r\n                    play();\r\n                }\r\n            }\r\n            function onMove(e) {\r\n                prev = move;\r\n                move = Utils.getTouch(e);\r\n                dragging = true;\r\n                // console.log(move);\r\n            }\r\n            function onUp(e) {\r\n                if (move && prev) {\r\n                    speed += (move.y - prev.y) * 4;\r\n                }\r\n                sy = ey = cy;\r\n                dragging = false;\r\n                move = null;\r\n                down = null;\r\n                prev = null;\r\n                up = Utils.getTouch(e);\r\n                // console.log(up);\r\n                removeDragListeners();\r\n            }\r\n            function _onWheel(e) {\r\n                if (!busy) {\r\n                    if (!e) e = event;\r\n                    var dir = (((e.deltaY < 0 || e.wheelDelta > 0) || e.deltaY < 0) ? 1 : -1)\r\n                    /*\r\n                    var evt = window.event || e;\r\n                    var delta = evt.detail ? evt.detail * -120 : evt.wheelDelta\r\n                    speed += delta;\r\n                    */\r\n                    speed += dir * 5;\r\n                    wheeling = true;\r\n                    play();\r\n                }\r\n            }\r\n            var onWheel = Utils.throttle(_onWheel, 25);\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onDown);\r\n                element.on('wheel', onWheel);\r\n                // element.addEventListener('DOMMouseScroll',handleScroll,false); // for Firefox\r\n                // element.addEventListener('mousewheel',    handleScroll,false); // for everyone else\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onDown);\r\n                element.off('wheel', onWheel);\r\n            };\r\n            function addDragListeners() {\r\n                angular.element($window).on('touchmove mousemove', onMove);\r\n                angular.element($window).on('touchend mouseup', onUp);\r\n            };\r\n            function removeDragListeners() {\r\n                angular.element($window).off('touchmove mousemove', onMove);\r\n                angular.element($window).off('touchend mouseup', onUp);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        },\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImg\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img=\"'/img/nature-01.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('ngImg', ['$parse', '$timeout', function ($parse, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            var src = $parse(attributes.ngImg, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            var image = new Image();\r\n            image.onload = function () {\r\n                attributes.$set('src', this.src);\r\n                setTimeout(function () {\r\n                    element.addClass('loaded');\r\n                }, 10);\r\n            }\r\n            image.load = function (src) {\r\n                element.removeClass('loaded');\r\n                this.src = src;\r\n            }\r\n            scope.$watch(src, function (newValue) {\r\n                if (!newValue) {\r\n                    attributes.$set('src', null);\r\n                } else {\r\n                    image.load(newValue);\r\n                }\r\n            });\r\n        }\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImgWorker\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * As ngImg but using webworker. Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img-worker=\"'/img/nature-02.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n\t</example>\r\n*/\r\napp.directive('ngImgWorker', ['$parse', 'WebWorker', function ($parse, WebWorker) {\r\n    var worker = new WebWorker('/js/workers/loader.min.js');\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            function doWork(src) {\r\n                element.removeClass('loaded');\r\n                function onImageLoaded(src) {\r\n                    attributes.$set('src', src);\r\n                    setTimeout(function () {\r\n                        element.addClass('loaded');\r\n                    }, 100);\r\n                }\r\n                worker.post({ url: src }).then(function (data) {\r\n                    onImageLoaded(data.url);\r\n                }, function (error) {\r\n                    onImageLoaded(null);\r\n                });\r\n            }\r\n            var src = scope.$eval(attributes.ngImgWorker);\r\n            if (!src) {\r\n                attributes.$set('src', null);\r\n            } else {\r\n                doWork(src);\r\n            }\r\n        }\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name control\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Dinamic form control generator through templates with extended validation\r\n   *\r\n   * @param {string} model the target model of control\r\n   * @param {string} [control=text] the type of control, available types (text, password, email, number, checkbox, textarea, datetime-local, select, autocomplete)\r\n   * @param {string} [form=Form] the name of the form\r\n   * @param {string} [title=Untitled] the title of the control\r\n   * @param {string} [placeholder=title] the placeholder of the control\r\n   * @param {string} [source=null] datasource of select as array\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   * @param {string} [required=false] if the control is required\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"select\" title=\"category\" placeholder=\"select a category\" model=\"model.category\" source=\"[{name:'Main',id:1}, {name:'Second',id:2}]\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"number\" title=\"dish price\" placeholder=\"type the price of the dish\" model=\"model.dish.price\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"checkbox\" title=\"is vegan friendly\" placeholder=\"please check if the dish is vegan friendly\" model=\"model.dish.isVeganFriendly\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('control', [function () {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        template: function (element, attributes) {\r\n            var form = attributes.form || 'Form';\r\n            var title = attributes.title || 'Untitled';\r\n            var placeholder = attributes.placeholder || title;\r\n            var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('');\r\n            var formKey = form + '.' + name;\r\n            var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n            var required = '';\r\n            var label = (attributes.label ? attributes.label : 'name');\r\n            var key = (attributes.key ? attributes.key : 'id');\r\n            var model = attributes.model;\r\n            if (attributes.required) {\r\n                required = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + form + '.' + name + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> &larr; required</span>';\r\n                switch (attributes.control) {\r\n                    case 'password':\r\n                        required = required + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> &larr; at least 6 chars</span>';\r\n                        break;\r\n                    case 'email':\r\n                        required = required + '<span ng-message=\"email\" class=\"label-error animated flash\"> &larr; incorrect</span>';\r\n                        break;\r\n                    case 'number':\r\n                        required = required + '<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    required = required + '<span ng-message=\"match\" class=\"label-error animated flash\"> &larr; not matching</span>';\r\n                }\r\n                required = required + '</span>';\r\n            } else {\r\n                required = ' (optional)';\r\n            }\r\n            var template = '<div ' + (attributes.readonly ? ' class=\"readonly\" ' : '') + ' ng-class=\"{ focus: ' + formKey + '.hasFocus, success: ' + formKey + '.$valid, error: ' + formKey + '.$invalid && (form.$submitted || ' + formKey + '.$touched), empty: !' + formKey + '.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + required + '</label>';\r\n            switch (attributes.control) {\r\n                case 'checkbox':\r\n                    template = '<div class=\"checkbox\">';\r\n                    template += '<span class=\"checkbox-label\">' + title + required + '</span>';\r\n                    template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + (attributes.required ? 'required=\"true\"' : '') + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                    template += '</div>';\r\n                    break;\r\n                case 'select':\r\n                    var options = attributes.number\r\n                        ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source\r\n                        : 'item.' + label + ' for item in ' + attributes.source + ' track by item.' + key;\r\n                    template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + ' ' + (attributes.required ? 'required=\"true\"' : '') + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                    break;\r\n                case 'autocomplete':\r\n                    var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                    var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                    var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                    var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                    template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                    template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                    break;\r\n                case 'textarea':\r\n                    template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" ' + (attributes.required ? 'required' : '') + ' rows=\"' + (attributes.rows ? attributes.rows : '1') + '\"' + formFocus + '></textarea>';\r\n                    break;\r\n                case 'datetime-local':\r\n                    placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n                    break;\r\n                case 'password':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"6\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n                    break;\r\n                case 'email':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n                    break;\r\n                case 'number':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n                    break;\r\n                case 'text':\r\n                default:\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n                    break;\r\n            }\r\n            return template + '</div>';\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n        },\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name controlAutocomplete\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom control type with autocomplete functionality. (use the shortcut version with control directive)\r\n   *\r\n   * @param {service} controlAutocomplete the datasource service\r\n   * @param {model} model the target model of control\r\n   * @param {boolean} [canCreate=false] setted on true the control can add new entities\r\n   * @param {boolean} [flatten=false] set to true to flat the value to the model\r\n   * @param {boolean} [queryable=false] set to true if is a queryable service\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12 empty focus\">\r\n                     <label for=\"dishname\" class=\"control-label\">dish name<span ng-messages=\"(myForm.$submitted || myForm.dishname.$touched) &amp;&amp; myForm.dishname.$error\" role=\"alert\" class=\"ng-inactive\"></span></label>\r\n                     <input name=\"dishname\" ng-model=\"model.name\" type=\"hidden\" required=\"\">\r\n                     <div control-autocomplete=\"dishesAutocomplete\" model=\"model.name\" label=\"name\" key=\"name\" can-create=\"true\" flatten=\"true\" queryable=\"false\" placeholder=\"type the name of the dish\" on-focus=\"myForm.dishname.hasFocus=true\" on-blur=\"myForm.dishname.hasFocus=false\" on-selected=\"onDishSelected($item)\" class=\"ng-isolate-scope\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.run(['$rootScope', '$q', function($rootScope, $q) {\r\n            $rootScope.dishesAutocomplete = ;\r\n            $rootScope.onDishSelected = function($item) {\r\n               alert($item);\r\n            };\r\n         }]);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('controlAutocomplete', ['$parse', '$window', '$timeout', 'Utils', function ($parse, $window, $timeout, Utils) {\r\n    var MAX_ITEMS = 5;\r\n    return {\r\n        restrict: 'A',\r\n        scope: {\r\n            service: '=controlAutocomplete',\r\n            canCreate: '=',\r\n            flatten: '=',\r\n            queryable: '=',\r\n            model: '=',\r\n            label: '@',\r\n            key: '@',\r\n        },\r\n        template: function (element, attributes) {\r\n            var template = '<div>';\r\n            template += '   <input class=\"form-control\" ng-model=\"phrase\" ng-model-options=\"{ debounce: 150 }\" placeholder=\"' + attributes.placeholder + '\" type=\"text\" ng-focus=\"onFocus()\">';\r\n            template += '   <ul class=\"form-autocomplete\" ng-show=\"items.length\">';\r\n            template += '       <li ng-repeat=\"item in items\" ng-class=\"{ active: active == $index }\" ng-click=\"onSelect(item)\">';\r\n            template += '           <span>{{item.NameA}}<span class=\"token\">{{item.NameB}}</span>{{item.NameC}}</span>';\r\n            template += '       </li>';\r\n            template += '   </ul>';\r\n            template += '</div>';\r\n            return template;\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n            var onSelected = $parse(attributes.onSelected);\r\n            var input = element.find('input');\r\n            var label = (scope.label ? scope.label : 'name');\r\n            var key = (scope.key ? scope.key : 'id');\r\n            function getPhrase() {\r\n                if (scope.model) {\r\n                    return scope.flatten ? scope.model : scope.model[label];\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n            scope.phrase = getPhrase();\r\n            scope.count = 0;\r\n            scope.items = [];\r\n            scope.active = -1;\r\n            scope.maxItems = scope.maxItems || Number.POSITIVE_INFINITY;\r\n            function Clear(phrase) {\r\n                scope.items.length = 0;\r\n                scope.count = 0;\r\n                scope.phrase = phrase || null;\r\n                input.val(scope.phrase);\r\n            }\r\n            function Current() {\r\n                var current = null;\r\n                if (scope.active != -1 && scope.items.length > scope.active) {\r\n                    current = scope.items[scope.active];\r\n                }\r\n                return current;\r\n            }\r\n            scope.onFocus = function () {\r\n                if (attributes.onFocus !== undefined) {\r\n                    scope.$parent.$eval(attributes.onFocus);\r\n                }\r\n                if (input.val() === getPhrase()) {\r\n                    input.val(null);\r\n                }\r\n            };\r\n            scope.onBlur = function () {\r\n                if (attributes.onBlur !== undefined) {\r\n                    scope.$parent.$eval(attributes.onBlur);\r\n                }\r\n                Clear(getPhrase());\r\n            };\r\n            scope.onSelect = function (item) {\r\n                if (scope.queryable) {\r\n                    scope.service.setItem(item).then(function (parsedItem) {\r\n                        onSelected({ $item: parsedItem }, scope.$parent, { $event: {} });\r\n                        $timeout(function () {\r\n                            if (scope.flatten) {\r\n                                scope.model = parsedItem[key];\r\n                            } else {\r\n                                scope.model = scope.model || {};\r\n                                angular.extend(scope.model, parsedItem);\r\n                            }\r\n                            scope.onBlur();\r\n                        }, 1);\r\n                    });\r\n                } else {\r\n                    onSelected({ $item: item }, scope.$parent, { $event: {} });\r\n                    if (scope.flatten) {\r\n                        scope.model = item[key];\r\n                    } else {\r\n                        scope.model = scope.model || {};\r\n                        angular.extend(scope.model, item);\r\n                    }\r\n                    scope.onBlur();\r\n                }\r\n            };\r\n            function onTyping(phrase) {\r\n                if (scope.canCreate) {\r\n                    if (scope.flatten) {\r\n                        if (key === label) {\r\n                            scope.model = phrase;\r\n                        }\r\n                    } else {\r\n                        scope.model = {};\r\n                        scope.model[label] = phrase;\r\n                    }\r\n                }\r\n            };\r\n            function Enter() {\r\n                var item = Current();\r\n                if (item) {\r\n                    scope.onSelect(item);\r\n                }\r\n                scope.$apply();\r\n            }\r\n            function Up() {\r\n                scope.active--;\r\n                if (scope.active < 0) {\r\n                    scope.active = scope.items.length - 1;\r\n                }\r\n                scope.$apply();\r\n            }\r\n            function Down() {\r\n                scope.active++;\r\n                if (scope.items.length == 0) {\r\n                    scope.active = -1;\r\n                } else if (scope.active >= scope.items.length) {\r\n                    scope.active = 0;\r\n                }\r\n                scope.$apply();\r\n            }\r\n            function Parse(data) {\r\n                scope.items = data.items;\r\n                scope.count = data.count;\r\n                angular.forEach(scope.items, function (value, index) {\r\n                    var name = value[label];\r\n                    var i = name.toLowerCase().indexOf(scope.phrase.toLowerCase());\r\n                    value.NameA = name.substr(0, i);\r\n                    value.NameB = name.substr(i, scope.phrase.length);\r\n                    value.NameC = name.substr(i + scope.phrase.length, name.length - (i + scope.phrase.length));\r\n                });\r\n            }\r\n            function Filter(data) {\r\n                var c = 0, i = [];\r\n                if (scope.phrase.length > 1) {\r\n                    angular.forEach(data.items, function (value, index) {\r\n                        var name = value[label];\r\n                        if (name.toLowerCase().indexOf(scope.phrase.toLowerCase()) !== -1) {\r\n                            if (i.length < MAX_ITEMS) {\r\n                                i.push(value);\r\n                            }\r\n                            c++;\r\n                        }\r\n                    });\r\n                }\r\n                Parse({\r\n                    count: c,\r\n                    items: i\r\n                });\r\n            }\r\n            function Search() {\r\n                scope.phrase = input.val();\r\n                scope.active = -1;\r\n                onTyping(scope.phrase);\r\n                if (scope.queryable) {\r\n                    scope.service.setPhrase(scope.phrase).then(function (success) {\r\n                        scope.items = success.items;\r\n                        scope.count = success.count;\r\n                    }, function (error) {\r\n                        console.log('Search.queryable.error', scope.phrase, error);\r\n                    }).finally(function () {\r\n\r\n                    });\r\n                } else {\r\n                    Filter({\r\n                        count: scope.service.length,\r\n                        items: scope.service\r\n                    });\r\n                    scope.$apply();\r\n                }\r\n            }\r\n            function onKeyDown(e) {\r\n                switch (e.keyCode) {\r\n                    case 9: // Tab\r\n                    case 13: // Enter\r\n                        Enter();\r\n                        if (scope.items.length) {\r\n                            e.preventDefault ? e.preventDefault() : null;\r\n                            return false;\r\n                        }\r\n                        break;\r\n                    case 38: // Up\r\n                        Up();\r\n                        break;\r\n                    case 40: // Down\r\n                        Down();\r\n                        break;\r\n                }\r\n            }\r\n            function onKeyUp(e) {\r\n                switch (e.keyCode) {\r\n                    case 9: // Tab\r\n                    case 13: // Enter\r\n                        break;\r\n                    case 39: // Right\r\n                        break;\r\n                    case 37: // Left\r\n                        break;\r\n                    case 38: // Up\r\n                        break;\r\n                    case 40: // Down\r\n                        break;\r\n                    default: // Text\r\n                        Search.call(this);\r\n                        break;\r\n                }\r\n            }\r\n            function onUp(e) {\r\n                if (Utils.getClosest(e.target, '[control-autocomplete]') === null) {\r\n                    scope.$apply(function () {\r\n                        scope.onBlur();\r\n                    });\r\n                }\r\n                return true;\r\n            }\r\n            function addListeners() {\r\n                input.on('keydown', onKeyDown);\r\n                input.on('keyup', onKeyUp);\r\n                angular.element($window).on('mouseup touchend', onUp);\r\n            };\r\n            function removeListeners() {\r\n                input.off('keydown', onKeyDown);\r\n                input.off('keyup', onKeyUp);\r\n                angular.element($window).off('mouseup touchend', onUp);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            var init = false;\r\n            function Init() {\r\n                if (!init) {\r\n                    addListeners();\r\n                    init = true;\r\n                }\r\n            }\r\n            scope.$watch('service', function (newValue) {\r\n                if (newValue && (newValue.length || scope.queryable)) {\r\n                    Init();\r\n                }\r\n            });\r\n            scope.$watchCollection('model', function (newValue) {\r\n                if (newValue) {\r\n                    if (scope.flatten && label === key) {\r\n                        scope.phrase = newValue;\r\n                        input.val(scope.phrase);\r\n                    } else if (newValue[label]) {\r\n                        scope.phrase = newValue[label];\r\n                        input.val(scope.phrase);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name validateType\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom validation type for ngModel\r\n   *\r\n   * @param {string} [validateType=number] the type of custom validation\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n\t\t<file name=\"index.html\">\r\n\t\t\t<form name=\"myForm\">\r\n\t\t\t\t<input name=\"myValue\" type=\"text\" ng-model=\"model\" validate-type=\"number\" />\r\n\t\t\t\t<span ng-messages=\"(myForm.$submitted || myForm.$touched) && myForm.myValue.$error\" role=\"alert\">\r\n\t\t\t\t\t<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>\r\n\t\t\t\t</span>\r\n\t\t\t</form>\r\n\t\t</file>\r\n\t\t<file name=\"script.js\">\r\n\t\t\tangular.module('examples', ['wsUtils']);\r\n\t\t</file>\r\n\t</example>\r\n*/\r\napp.directive('validateType', function () {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var type = attributes.validateType;\r\n            switch (type) {\r\n                case 'number':\r\n                    model.$parsers.unshift(function (value) {\r\n                        model.$setValidity(type, String(value).indexOf(Number(value).toString()) !== -1);\r\n                        return value;\r\n                    });\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n});\n\napp.filter('customCurrency', ['$filter', function ($filter) {\n    var legacyFilter = $filter('currency');\n    return function (cost, currency) {\n        return legacyFilter(cost * currency.ratio, currency.formatting);\n    }\n}]);\n\napp.filter('customSize', ['APP', function (APP) {\n    return function (inches) {\n        if (APP.unit === APP.units.IMPERIAL) {\n            var feet = Math.floor(inches / 12);\n            inches = inches % 12;\n            inches = Math.round(inches * 10) / 10;\n            return (feet ? feet + '\\' ' : '') + (inches + '\\'\\'');\n        } else {\n            var meters = Math.floor(inches * APP.size.ratio);\n            var cm = (inches * APP.size.ratio * 100) % 100;\n            cm = Math.round(cm * 10) / 10;\n            return (meters ? meters + 'm ' : '') + (cm + 'cm');\n        }\n    };\n}]);\n\napp.filter('customWeight', ['APP', function (APP) {\n    return function (pounds) {\n        if (APP.unit === APP.units.IMPERIAL) {\n            if (pounds < 1) {\n                var oz = pounds * 16;\n                oz = Math.round(oz * 10) / 10;\n                return (oz ? oz + 'oz ' : '');\n            } else {\n                pounds = Math.round(pounds * 100) / 100;\n                return (pounds ? pounds + 'lb ' : '');\n            }\n        } else {\n            var kg = Math.floor(pounds * APP.weight.ratio / 1000);\n            var grams = (pounds * APP.weight.ratio) % 1000;\n            grams = Math.round(grams * 10) / 10;\n            return (kg ? kg + 'kg ' : '') + (grams + 'g');\n        }\n    };\n}]);\n\napp.filter('customNumber', ['$filter', function ($filter) {\n    var filter = $filter('number');\n    return function (value, precision, unit) {\n        unit = unit || '';\n        return (value ? filter(value, precision) + unit : '-');\n    }\n}]);\n\napp.filter('customDate', ['$filter', function ($filter) {\n    var filter = $filter('date');\n    return function (value, format, timezone) {\n        return value ? filter(value, format, timezone) : '-';\n    }\n}]);\n\napp.filter('customTime', ['$filter', function ($filter) {\n    return function (value, placeholder) {\n        if (value) {\n            return Utils.parseTime(value);\n        } else {\n            return (placeholder ? placeholder : '-');\n        }\n    }\n}]);\n\napp.filter('customDigital', ['$filter', function ($filter) {\n    return function (value, placeholder) {\n        if (value) {\n            return Utils.parseHour(value);\n        } else {\n            return (placeholder ? placeholder : '-');\n        }\n    }\n}]);\n\napp.filter('customString', ['$filter', function ($filter) {\n    return function (value, placeholder) {\n        return value ? value : (placeholder ? placeholder : '-');\n    }\n}]);\n\napp.filter('customEnum', function () {\n    return function (val) {\n        val = val + 1;\n        return val < 10 ? '0' + val : val;\n    };\n});\n\n/*global angular,FB */\n\napp.value('UserRoles', [{\n    name: 'Guest', id: 1\n}, {\n    name: 'User', id: 2\n}, {\n    name: 'Supervisor', id: 3\n}, {\n    name: 'Admin', id: 4\n}]);\n\napp.value('UserRolesEnum', {\n    'Guest': 1,\n    'User': 2,\n    'Supervisor': 3,\n    'Admin': 4,\n});\n\napp.factory('User', ['UserRolesEnum', function (UserRolesEnum) {\n    function User(data) {\n        // Extend instance with data\n        data ? angular.extend(this, data) : null;\n    }\n    User.prototype = {\n        // If user instance is in role Administrator\n        isAdmin: function () {\n            return this.role === UserRolesEnum.Admin;\n        },\n        // If user parameters equals user instance\n        isUser: function (user) {\n            return this.email === user.email;\n        },\n        picture: function (size) {\n          size = size || 'sm';\n          var w;\n          switch(size) {\n              case 'sm':\n                w = 50;\n              break;\n              case 'md':\n                w = 300;\n              break;\n              default:\n          }\n          return this.facebookId ? 'https://graph.facebook.com/'+ this.facebookId +'/picture?width=' + w + '&height=' + w + '&type=square' : '/img/avatar-default.png';\n        },\n        backgroundPicture: function(size) {\n            return 'background-image: url(' + this.picture(size) + ');';\n        },\n    };\n    return User;\n}]);\n/*global angular,FB */\n\n/*global angular,FB */\n\napp.factory('FacebookService', ['$q', 'APP', function ($q, APP) {\n\n    function FacebookService() {\n\n    }\n\n    FacebookService.FB = function () {\n        var deferred = $q.defer();\n        if (window['FB'] !== undefined) {\n            deferred.resolve(window['FB']);\n        } else {\n            FacebookService.init().then(function (success) {\n                deferred.resolve(window['FB']);\n            }, function (error) {\n                deferred.reject(error);\n            })\n        }\n        return deferred.promise;\n    }\n\n    FacebookService.getFacebookMe = function () {\n        var deferred = $q.defer();\n\t\tFacebookService.FB().then(function (facebook) {\n            facebook.api('/me', { fields: 'id,name,first_name,last_name,email,gender,picture,cover,link' }, function (response) {\n                if (!response || response.error) {\n                    deferred.reject('Error occured');\n                } else {\n                    deferred.resolve(response);\n                }\n            });\n        });\n        return deferred.promise;\n    };\n\n    FacebookService.getPictureMe = function () {\n        var deferred = $q.defer();\n\t\tFacebookService.FB().then(function (facebook) {\n            facebook.api('/me/picture', { width: 300, height: 300, type: 'square' }, function (response) {\n                if (!response || response.error) {\n                    deferred.reject('Error occured');\n                } else {\n                    deferred.resolve(response);\n                }\n            });\n        });\n        return deferred.promise;\n    };\n\n    FacebookService.getLoginStatus = function () {\n        var deferred = $q.defer();\n\t\tFacebookService.FB().then(function (facebook) {\n            facebook.getLoginStatus(function (response) {\n                onFacebookStatus(response, deferred);\n            });\n        });\n        return deferred.promise;\n    };\n\n    FacebookService.login = function () {\n        var deferred = $q.defer();\n\t\tFacebookService.FB().then(function (facebook) {\n            facebook.login(function (response) {\n                onFacebookStatus(response, deferred);\n            }, {\n                scope: 'public_profile,email' // publish_stream,\n            });\n        });\n        return deferred.promise;\n    };\n\n    FacebookService.logout = function () {\n        var deferred = $q.defer();\n\t\tFacebookService.FB().then(function (facebook) {\n\t\t\tfacebook.logout(function (response) {\n\t\t\t\tdeferred.resolve(response);\n\t\t\t});\n        });\n        return deferred.promise;\n    };\n\n    FacebookService.deletePermissions = function () {\n        var deferred = $q.defer();\n\t\tFacebookService.FB().then(function (facebook) {\n\t\t\tfacebook.api('/me/permissions', 'delete', function (response) {\n\t\t\t\tdeferred.resolve(response);\n            });\n        });\n        return deferred.promise;\n    };\n\n    FacebookService.init = function () {\n        var deferred = $q.defer();\n        window.fbAsyncInit = function () {\n            FB.init({\n                appId: APP.FACEBOOK_APP_ID,\n                status: true,\n                cookie: true,\n                xfbml: true,\n                version: 'v2.5'\n            });\n            deferred.resolve(FB);\n        };\n        try {\n            (function (d, s, id) {\n                var js, fjs = d.getElementsByTagName(s)[0];\n                if (d.getElementById(id)) { return; }\n                js = d.createElement(s); js.id = id;\n                js.src = \"//connect.facebook.net/en_US/sdk.js\";\n                fjs.parentNode.insertBefore(js, fjs);\n            }(document, 'script', 'facebook-jssdk'));\n        } catch (e) {\n            deferred.reject(e);\n        }\n        return deferred.promise;\n    };\n\n    function onFacebookStatus(response, deferred) {\n        FacebookService.authResponse = null;\n        if (response.status === 'connected') {\n            FacebookService.authResponse = response.authResponse;\n            deferred.resolve(response);\n        } else if (response.status === 'not_authorized') {\n            deferred.reject(response);\n        } else {\n            deferred.reject(response);\n        }\n    };\n\n    return FacebookService;\n\n}]);\n\napp.factory('Users', ['$q', '$http', '$location', '$timeout', 'APP', 'LocalStorage', 'User', function ($q, $http, $location, $timeout, APP, LocalStorage, User) {\n\n    // PRIVATE VARIABLE FOR CURRENT USER\n    var _currentUser = null;\n\n    function Users() {\n    }\n\n    Users.prototype = {\n    };\n\n    // STATIC CLASS METHODS\n    Users.currentUser = function () {\n        return _currentUser;\n    };\n\n    Users.getCurrentUser = function () {\n        var deferred = $q.defer();\n        if (_currentUser) {\n            deferred.resolve(_currentUser);\n        } else {\n            $http.get(APP.API + '/api/users/current/').then(function success(response) {\n                if (response && response.data) {\n                    _currentUser = new User(response.data);\n                    deferred.resolve(_currentUser);\n                } else {\n                    deferred.resolve(null); // deferred.reject(null);\n                }\n            }, function error(response) {\n                deferred.reject(response);\n            });\n        }\n        return deferred.promise;\n    };\n\n    Users.isLogged = function () {\n        var deferred = $q.defer();\n        Users.getCurrentUser().then(function (user) {\n            // console.log('Users.isLogged.success', user);\n            user && user.isAuthenticated ? deferred.resolve(user) : deferred.reject();\n        }, function error(response) {\n            // console.log('Users.isLogged.error', data);\n            deferred.reject(response);\n        })\n        return deferred.promise;\n    };\n\n    Users.isAdmin = function () {\n        var deferred = $q.defer();\n        Users.getCurrentUser().then(function (user) {\n            user && user.isAuthenticated && user.isAdmin ? deferred.resolve(user) : deferred.reject();\n        }, function error(response) {\n            deferred.reject(response);\n        })\n        return deferred.promise;\n    };\n\n    Users.isLoggedOrGoTo = function(redirect) {\n        var deferred = $q.defer();\n        Users.getCurrentUser().then(function (user) {\n            // console.log('Users.isLogged.success', user);\n            if (user && user.isAuthenticated) {\n                deferred.resolve(user);\n            } else {\n                deferred.reject();\n                $location.path(redirect);\n            }\n        }, function error(response) {\n            // console.log('Users.isLogged.error', data);\n            deferred.reject(response);\n            $location.path(redirect);\n        })\n        return deferred.promise;\n    };\n\n    Users.isAdminOrGoTo = function(redirect) {\n        var deferred = $q.defer();\n        Users.getCurrentUser().then(function (user) {\n            // console.log('Users.isLogged.success', user);\n            if (user && user.isAuthenticated && user.isAdmin) {\n                deferred.resolve(user);\n            } else {\n                deferred.reject();\n                $location.path(redirect);\n            }\n        }, function error(response) {\n            // console.log('Users.isLogged.error', data);\n            deferred.reject(response);\n            $location.path(redirect);\n        })\n        return deferred.promise;\n    },\n\n    /** LOGIN METHODS **/\n    Users.signup = function (model) {\n        var deferred = $q.defer();\n        $http.post(APP.API + '/api/users/signup/', model).then(function success(response) {\n            _currentUser = new User(response.data);\n            deferred.resolve(_currentUser);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    Users.signin = function (model) {\n        var deferred = $q.defer();\n        $http.post(APP.API + '/api/users/signin/', model).then(function success(response) {\n            _currentUser = new User(response.data);\n            deferred.resolve(_currentUser);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    Users.signInWithFacebook = function (auth) {\n        var deferred = $q.defer();\n        $http.post(APP.API + '/api/users/signinwithfacebook/', auth).then(function success(response) {\n            _currentUser = new User(response.data);\n            deferred.resolve(_currentUser);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    Users.signout = function () {\n        var deferred = $q.defer();\n        $http.get(APP.API + '/api/users/signout/').then(function success(response) {\n            _currentUser = null;\n            deferred.resolve(response.data);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    Users.detail = function (userRoute) {\n        var deferred = $q.defer();\n        $http.get(APP.API + '/api/users/route/' + userRoute).then(function success(response) {\n            deferred.resolve(new User(response.data));\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    return Users;\n}]);\n\napp.factory('Categories', ['$http', '$q', 'APP', function ($http, $q, APP) {\n\n    function Categories() {\n    }\n\n    Categories.get = function () {\n        var deferred = $q.defer();\n        $http.get(APP.API + '/api/categories/').then(function success(response) {\n            deferred.resolve(response.data);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    Categories.detail = function (categoryId) {\n        var deferred = $q.defer();\n        $http.get(APP.API + '/api/categories/' + categoryId).then(function success(response) {\n            deferred.resolve(response.data);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    return Categories;\n}]);\n\napp.factory('DishesTest', ['APP', 'Dish', function (APP, Dish) {\n\n    var uniqueId = 100;\n\n    function getRandomItems() {\n        var items = [];\n        while (items.length < 10) {\n            items.push({\n                id: uniqueId,\n                name: 'dish ' + uniqueId,\n                price: 3.20,\n                yes: Math.floor(Math.random() * 999),\n                no: Math.floor(Math.random() * 999),\n                pictures: [{\n                    route: 'http://lorempixel.com/750/375/food/' + (1 + uniqueId % 10), // 'http://placehold.it/750x375',\n                }],\n                user: {\n                    userName: 'User',\n                }\n            });\n            uniqueId++;\n        }\n        return items;\n    }\n\n    function TestSource() {\n    }\n    TestSource.uri = {\n        paging: false,\n    };\n    TestSource.resolve = function (rows) {\n        var items = getRandomItems();\n        angular.forEach(items, function (item) {\n            this.push(new Dish(item));\n        }, rows);\n    };\n\n    return TestSource;\n}]);\n\napp.factory('Posts', ['$http', '$q', 'APP', 'Post', function ($http, $q, APP, Post) {\n\n    function Posts() {\n    }\n    Posts.uri = {\n        paging: APP.API + '/api/stream/paged',\n    };\n    Posts.resolve = function (items, rows) {\n        angular.forEach(items, function (item) {\n            this.push(new Post(item));\n        }, rows);\n    };\n\n    Posts.add = function (model) {\n        var deferred = $q.defer();\n        $http.post(APP.API + '/api/post/', model).then(function success(response) {\n            deferred.resolve(response.data);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    return Posts;\n}]);\n\napp.factory('Dishes', ['$http', '$q', 'APP', 'Dish', function ($http, $q, APP, Dish) {\n\n    function Dishes() {\n    }\n    Dishes.uri = {\n        paging: APP.API + '/api/dishes/paged',\n    };\n    Dishes.resolve = function (items, rows) {\n        angular.forEach(items, function (item) {\n            this.push(new Dish(item));\n        }, rows);\n    };\n\n    Dishes.detail = function (id) {\n        var deferred = $q.defer();\n        $http.get(APP.API + '/api/dishes/' + id).then(function success(response) {\n            deferred.resolve(new Dish(response.data));\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    Dishes.add = function (model) {\n        var deferred = $q.defer();\n        $http.post(APP.API + '/api/dishes/', model).then(function success(response) {\n            deferred.resolve(response.data);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    Dishes.get = function () {\n        var deferred = $q.defer();\n        $http.get(APP.API + '/api/dishes/').then(function success(response) {\n            var rows = [];\n            angular.forEach(response.data, function (item) {\n                this.push(new Dish(item));\n            }, rows);\n            deferred.resolve(rows);\n        }, function error(response) {\n            deferred.reject(response);\n        });\n        return deferred.promise;\n    };\n\n    return Dishes;\n}]);\n\napp.factory('DishesAutocomplete', ['$q', '$http', '$timeout', 'APP', function ($q, $http, $timeout, APP) {\n\n    var MAX_ITEMS = 5;\n\n    function DishesAutocomplete() {\n    }\n\n    DishesAutocomplete.prototype = {\n        setPhrase: function (phrase) {\n            // console.log('DishesAutocomplete.setPhrase', phrase);\n            var deferred = $q.defer();\n            $http.post(APP.API + '/api/dishes/autocomplete', { phrase: phrase }).then(function success(response) {\n                var data = {\n                    items: [],\n                    count: response.data.length,\n                };\n                angular.forEach(response.data, function (v, i) {\n                    if (i < MAX_ITEMS) {\n                        var value = {\n                            id: v.id,\n                            name: v.name,\n                        };\n                        var offset = v.name.toLowerCase().indexOf(phrase.toLowerCase());\n                        var length = phrase.length;\n                        value.NameA = value.name.substr(0, offset);\n                        value.NameB = value.name.substr(offset, length);\n                        value.NameC = value.name.substr(offset + length, value.name.length - (offset + length));\n                        data.items.push(value);\n                    }\n                });\n                deferred.resolve(data);\n            }, function error(response) {\n                deferred.reject(response);\n            });\n            return deferred.promise;\n        },\n        setItem: function (item) {\n            var deferred = $q.defer();\n            $http.get(APP.API + '/api/dishes/' + item.id).then(function success(response) {\n                console.log('autoComplete.setItem', response.data);\n                deferred.resolve(response.data);\n            }, function error(response) {\n                deferred.reject(response);\n            });\n            return deferred.promise;\n        },\n    };\n\n    return DishesAutocomplete;\n\n}]);\n\napp.factory('DataFilter', [function () {\n    function DataFilter(data) {\n        /*\n        this.dateFrom = null;\n        this.dateTo = null;\n        this.search = null;\n        this.status = null;\n        */\n        data ? angular.extend(this, data) : null;\n    }\n    DataFilter.prototype = {\n        getSearchParams: function (search) {\n            var a = [];\n            if (search) {\n                for (var p in search) {\n                    a.push({ name: p, value: search[p] });\n                }\n            }\n            return a;\n        },\n        getParams: function (source, infinite) {\n            var post = {}, value;\n            for (var p in this) {\n                if (p === 'dateFrom' ||\n                    p === 'dateTo' ||\n                    p === 'status') {\n                    value = this[p];\n                    if (value !== undefined) {\n                        post[p] = value;\n                    }\n                } else if (p === 'search') {\n                    post[p] = JSON.stringify(this.getSearchParams(this[p]), null, '');\n                }\n            }\n            post.page = source.page;\n            post.size = source.size;\n            post.infinite = infinite;\n            return post;\n        },\n    };\n    return DataFilter;\n}]);\n\napp.factory('DataSource', ['$q', '$http', '$httpAsync', '$timeout', '$rootScope', 'DataFilter', function ($q, $http, $httpAsync, $timeout, $rootScope, DataFilter) {\n\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\n\n    function DataSource(data) {\n        this.busy = false;\n        this.error = false;\n        this.size = 10;\n        this.maxPages = 10;\n        this.rows = [];\n        this.filters = {};\n        this.service = {\n            url: '/api/items/paging',\n            resolve: function (items, rows) {\n                angular.forEach(items, function (item) {\n                    this.push(item);\n                }, rows);\n            },\n        };\n        data ? angular.extend(this, data) : null;\n        this.filters = new DataFilter(this.filters);\n        // FAKE SERVICE FOR TEST !!!\n        if (this.service.uri.paging === false) {\n            this.get = function (deferred, infinite) {\n                this.busy = true;\n                this.error = false;\n                $timeout(function () {\n                    infinite ? null : this.rows.length = 0;\n                    this.service.resolve(this.rows);\n                    this.page = 1;\n                    this.pages = 2;\n                    this.count = this.rows.length;\n                    this.pagination = this.getPages();\n                    this.busy = false;\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\n                    deferred.resolve(this.rows);\n                    // console.log('DataSource.get');\n                }.bind(this), 1000);\n            };\n        }\n        this.flush();\n    }\n    DataSource.prototype = {\n        flush: function () {\n            this.pages = PAGES_MAX;\n            this.page = 1;\n            this.count = 0;\n            this.opened = null;\n        },\n        resolve: function (response) {\n            var responseHeader = response.headers('X-Pagination');\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\n            // console.log('response', response, 'responseHeader', responseHeader, 'responseView', responseView);\n            if (responseView) {\n                this.page = responseView.page;\n                this.size = responseView.size;\n                this.pages = responseView.pages;\n                this.count = responseView.count;\n            } else {\n                this.page = 0;\n                this.size = responseView.size;\n                this.pages = 0;\n                this.count = 0;\n            }\n            this.pagination = this.getPages();\n        },\n        get: function (deferred, infinite) {\n            this.busy = true;\n            this.error = false;\n            $httpAsync.get(this.service.uri.paging, { params: this.filters.getParams(this) }).then(function success(response) {\n                this.resolve(response);\n                infinite ? null : this.rows.length = 0;\n                this.service.resolve(response.data, this.rows);\n                $rootScope.$broadcast('onDataSourceUpdate', this);\n                deferred.resolve(this.rows);\n            }.bind(this), function error(response) {\n                console.log('error.response', response);\n                this.error = true;\n                deferred.reject(response);\n            }.bind(this))\n                .finally(function () {\n                    // console.log('DataSource.get');\n                    $timeout(function () {\n                        this.busy = false;\n                    }.bind(this), 1000);\n                }.bind(this));\n        },\n        paging: function () {\n            var deferred = $q.defer();\n            if (this.busy || this.page > this.pages) {\n                deferred.reject();\n            } else {\n                // console.log('DataSource.paging');\n                this.opened = null;\n                this.get(deferred);\n            }\n            return deferred.promise;\n        },\n        refresh: function () {\n            var deferred = $q.defer();\n            if (this.busy) {\n                deferred.reject();\n            } else {\n                // console.log('DataSource.refresh');\n                this.flush();\n                this.get(deferred);\n            }\n            return deferred.promise;\n        },\n        more: function () {\n            var deferred = $q.defer();\n            if (this.busy || this.page + 1 > this.pages) {\n                deferred.reject();\n            } else {\n                // console.log('DataSource.more');\n                this.page++;\n                this.get(deferred, true);\n            }\n            return deferred.promise;\n        },\n        filter: function () {\n            this.page = 1;\n            this.pages = PAGES_MAX;\n            this.paging();\n        },\n        prevPage: function () {\n            var page = this.page - 1;\n            if (page > 0 && page <= this.pages) {\n                this.page = page;\n                this.paging();\n            }\n        },\n        nextPage: function () {\n            var page = this.page + 1;\n            if (page > 0 && page <= this.pages) {\n                this.page = page;\n                this.paging();\n            }\n        },\n        gotoPage: function (page) {\n            if (page > 0 && page <= this.pages) {\n                this.page = page;\n                this.paging();\n            }\n        },\n        firstPage: function () {\n            if (this.page !== 1) {\n                this.page = 1;\n                this.paging();\n            }\n        },\n        lastPage: function () {\n            if (this.page !== this.pages) {\n                this.page = this.pages;\n                this.paging();\n            }\n        },\n        hasMany: function () {\n            return this.count > 0 && this.pages > this.maxPages;\n        },\n        hasMorePagesBehind: function () {\n            var startingIndex = Math.max(0, this.page - this.maxPages);\n            return startingIndex > 0;\n        },\n        hasMorePagesNext: function () {\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\n            return endingIndex < this.pages;\n        },\n        isPage: function (number) {\n            return this.page === number;\n        },\n        hasPages: function () {\n            return this.pages > 0 && this.pages < PAGES_MAX;\n        },\n        getPages: function () {\n            var a = [], i;\n            if (this.hasPages()) {\n                var startingIndex = Math.max(0, this.page - this.maxPages);\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\n                i = startingIndex;\n                while (i < endingIndex) {\n                    a.push({ number: (i + 1) });\n                    i++;\n                }\n            }\n            return a;\n        },\n        openClose: function (index) {\n            if (this.opened === index) {\n                this.opened = null;\n            } else {\n                this.opened = index;\n            }\n        }\n    };\n    return DataSource;\n}]);\n\napp.factory('Cookie', ['$q', '$window', function ($q, $window) {\n    function Cookie() {\n    }\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\n    Cookie._set = function (name, value, days) {\n        if (days) {\n            var date = new Date();\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n            var expires = \"; expires=\" + date.toGMTString();\n        } else {\n            var expires = \"\";\n        }\n        $window.document.cookie = name + \"=\" + value + expires + \"; path=/\";\n    }\n    Cookie.set = function (name, value, days) {\n        try {\n            var cache = [];\n            var json = JSON.stringify(value, function (key, value) {\n                if (key === 'pool') {\n                    return;\n                }\n                if (typeof value === 'object' && value !== null) {\n                    if (cache.indexOf(value) !== -1) {\n                        // Circular reference found, discard key\n                        return;\n                    }\n                    cache.push(value);\n                }\n                return value;\n            });\n            cache = null;\n            Cookie._set(name, json, days);\n        } catch (e) {\n            console.log('Cookie.set.error serializing', name, value, e);\n        }\n    };\n    Cookie.get = function (name) {\n        var cookieName = name + \"=\";\n        var ca = $window.document.cookie.split(';');\n        for (var i = 0; i < ca.length; i++) {\n            var c = ca[i];\n            while (c.charAt(0) == ' ') {\n                c = c.substring(1, c.length);\n            }\n            if (c.indexOf(cookieName) == 0) {\n                var value = c.substring(cookieName.length, c.length);\n                var data = null;\n                try {\n                    data = JSON.parse(value);\n                } catch (e) {\n                    console.log('Cookie.get.error parsing', key, e);\n                };\n                return data;\n            }\n        }\n        return null;\n    };\n    Cookie.delete = function (name) {\n        Cookie._set(name, \"\", -1);\n    };\n    Cookie.on = function (name) {\n        var deferred = $q.defer();\n        var i, interval = 1000, elapsed = 0, timeout = Cookie.TIMEOUT;\n        function checkCookie() {\n            if (elapsed > timeout) {\n                deferred.reject('timeout');\n            } else {\n                var c = Cookie.get(name);\n                if (c) {\n                    deferred.resolve(c);\n                } else {\n                    elapsed += interval;\n                    i = setTimeout(checkCookie, interval);\n                }\n            }\n        }\n        checkCookie();\n        return deferred.promise;\n    };\n    return Cookie;\n}]);\n\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\n    function LocalStorage() {\n    }\n    function isLocalStorageSupported() {\n        var supported = false;\n        try {\n            supported = 'localStorage' in $window && $window['localStorage'] !== null;\n            if (supported) {\n                $window.localStorage.setItem('test', '1');\n                $window.localStorage.removeItem('test');\n            } else {\n                supported = false;\n            }\n        } catch (e) {\n            supported = false;\n        }\n        return supported;\n    }\n    LocalStorage.isSupported = isLocalStorageSupported();\n    if (LocalStorage.isSupported) {\n        LocalStorage.set = function (name, value) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function (key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                $window.localStorage.setItem(name, json);\n            } catch (e) {\n                console.log('LocalStorage.set.error serializing', name, value, e);\n            }\n        };\n        LocalStorage.get = function (name) {\n            var value = null;\n            if ($window.localStorage[name] !== undefined) {\n                try {\n                    value = JSON.parse($window.localStorage[name]);\n                } catch (e) {\n                    console.log('LocalStorage.get.error parsing', name, e);\n                }\n            }\n            return value;\n        };\n        LocalStorage.delete = function (name) {\n            $window.localStorage.removeItem(name);\n        };\n        LocalStorage.on = function (name) {\n            var deferred = $q.defer();\n            var i, timeout = Cookie.TIMEOUT;\n            function storageEvent(e) {\n                // console.log('LocalStorage.on', name, e);\n                clearTimeout(i);\n                if (e.originalEvent.key == name) {\n                    try {\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                        deferred.resolve(value);\n                    } catch (e) {\n                        console.log('LocalStorage.on.error parsing', name, e);\n                        deferred.reject('error parsing ' + name);\n                    }\n                }\n            }\n            angular.element($window).on('storage', storageEvent);\n            i = setTimeout(function () {\n                deferred.reject('timeout');\n            }, timeout);\n            return deferred.promise;\n        };\n    } else {\n        console.log('LocalStorage.unsupported switching to cookies');\n        LocalStorage.set = Cookie.set;\n        LocalStorage.get = Cookie.get;\n        LocalStorage.delete = Cookie.delete;\n        LocalStorage.on = Cookie.on;\n    }\n    return LocalStorage;\n}]);\n\napp.factory('Vector', function() {\n\tfunction Vector(x, y) {\n        this.x = x || 0;\n        this.y = y || 0;\n    }\n    Vector.make = function (a, b) {\n        return new Vector(b.x - a.x, b.y - a.y);\n    };\n    Vector.size = function (a) {\n        return Math.sqrt(a.x * a.x + a.y * a.y);\n    };\n    Vector.normalize = function (a) {\n        var l = Vector.size(a);\n        a.x /= l;\n        a.y /= l;\n        return a;\n    };\n    Vector.incidence = function (a, b) {\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\n        // if (angle < 0) angle += 2 * Math.PI;\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\n        return angle;\n    };\n    Vector.distance = function (a, b) {\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\n    };\n    Vector.cross = function (a, b) {\n        return (a.x * b.y) - (a.y * b.x);\n    };\n    Vector.difference = function (a, b) {\n        return new Vector(b.x - a.x, b.y - a.y);\n    };\n    Vector.prototype = {\n        size: function () {\n            return Vector.size(this);\n        },\n        normalize: function () {\n            return Vector.normalize(this);\n        },\n        incidence: function (b) {\n            return Vector.incidence(this, b);\n        },\n        cross: function (b) {\n            return Vector.cross(this, b);\n        },\n        towards: function (b, friction) {\n            friction = friction || 0.125;\n            this.x += (b.x - this.x) * friction;\n            this.y += (b.y - this.y) * friction;\n            return this;\n        },\n        add: function (b) {\n            this.x += b.x;\n            this.y += b.y;\n            return this;\n        },\n        friction: function (b) {\n            this.x *= b;\n            this.y *= b;\n            return this;\n        },\n        copy: function (b) {\n            return new Vector(this.x, this.y);\n        },\n        toString: function () {\n            return '{' + this.x + ',' + this.y + '}';\n        },\n    };\n    return Vector;\n});\n\napp.factory('Utils', ['Vector', function (Vector) {\n    (function () {\n        var lastTime = 0;\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\n        }\n        if (!window.requestAnimationFrame) {\n            window.requestAnimationFrame = function (callback, element) {\n                var currTime = new Date().getTime();\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\n                lastTime = currTime + timeToCall;\n                return id;\n            };\n        }\n        if (!window.cancelAnimationFrame) {\n            window.cancelAnimationFrame = function (id) {\n                clearTimeout(id);\n            };\n        }\n    }());\n\n    var transformProperty = function detectTransformProperty() {\n        var transformProperty = 'transform',\n            safariPropertyHack = 'webkitTransform';\n\t\tvar div = document.createElement(\"DIV\");\n        if (typeof div.style[transformProperty] !== 'undefined') {\n            ['webkit', 'moz', 'o', 'ms'].every(function(prefix) {\n                var e = '-' + prefix + '-transform';\n                if (typeof div.style[e] !== 'undefined') {\n                    transformProperty = e;\n                    return false;\n                }\n                return true;\n            });\n        } else if (typeof div.style[safariPropertyHack] !== 'undefined') {\n            transformProperty = '-webkit-transform';\n        } else {\n            transformProperty = undefined;\n        }\n        return transformProperty;\n    } ();\n\n    var _isTouch;\n    function isTouch() {\n        if (!_isTouch) {\n            _isTouch = {\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\n            }\n        }\n        // console.log(_isTouch);\n        return _isTouch.value;\n    }\n\n    function getTouch(e, previous) {\n        var t = new Vector();\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\n            var touch = null;\n            var event = e.originalEvent ? e.originalEvent : e;\n            var touches = event.touches.length ? event.touches : event.changedTouches;\n            if (touches && touches.length) {\n                touch = touches[0];\n            }\n            if (touch) {\n                t.x = touch.pageX;\n                t.y = touch.pageY;\n            }\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\n            t.x = e.pageX;\n            t.y = e.pageY;\n        }\n        if (previous) {\n            t.s = Vector.difference(previous, t);\n        }\n        t.type = e.type;\n        return t;\n    }\n\n    function getRelativeTouch(element, point) {\n        var rect = element[0].getBoundingClientRect();\n        var e = new Vector(rect.left,  rect.top);\n        return Vector.difference(e, point);\n    }\n\n    function getClosest(el, selector) {\n        var matchesFn, parent;\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\n            if (typeof document.body[fn] == 'function') {\n                matchesFn = fn;\n                return true;\n            }\n            return false;\n        });\n        while (el !== null) {\n            parent = el.parentElement;\n            if (parent !== null && parent[matchesFn](selector)) {\n                return parent;\n            }\n            el = parent;\n        }\n        return null;\n    }\n\n\n    var getNow = Date.now || function() {\n        return new Date().getTime();\n    };\n\n    function throttle(func, wait, options) {\n        // Returns a function, that, when invoked, will only be triggered at most once\n        // during a given window of time. Normally, the throttled function will run\n        // as much as it can, without ever going more than once per `wait` duration;\n        // but if you'd like to disable the execution on the leading edge, pass\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\n        var context, args, result;\n        var timeout = null;\n        var previous = 0;\n        if (!options) options = {};\n        var later = function () {\n            previous = options.leading === false ? 0 : getNow();\n            timeout = null;\n            result = func.apply(context, args);\n            if (!timeout) context = args = null;\n        };\n        return function () {\n            var now = getNow();\n            if (!previous && options.leading === false) previous = now;\n            var remaining = wait - (now - previous);\n            context = this;\n            args = arguments;\n            if (remaining <= 0 || remaining > wait) {\n                if (timeout) {\n                    clearTimeout(timeout);\n                    timeout = null;\n                }\n                previous = now;\n                result = func.apply(context, args);\n                if (!timeout) context = args = null;\n            } else if (!timeout && options.trailing !== false) {\n                timeout = setTimeout(later, remaining);\n            }\n            return result;\n        };\n    }\n\n    var Style = function() {\n        function Style() {\n            this.props = {\n                scale: 1,\n                hoverScale: 1,\n                currentScale: 1,\n            }\n        }\n        Style.prototype = {\n            set: function (element) {\n                var styles = [];\n                angular.forEach(this, function (value, key) {\n                    if (key !== 'props')\n                        styles.push(key + ':' + value);\n                });\n                element.style.cssText = styles.join(';') + ';';\n            },\n            transform: function (transform) {\n                this[Utils.transformProperty] = transform;\n            },\n            transformOrigin: function (x, y) {\n                this[Utils.transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\n                this[Utils.transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\n            },\n        };\n        return Style;\n    }();\n\n    function Utils() {\n    }\n\n\tUtils.transformProperty = transformProperty;\n    Utils.getTouch = getTouch;\n    Utils.getRelativeTouch = getRelativeTouch;\n    Utils.getClosest = getClosest;\n    Utils.throttle = throttle;\n    Utils.Style = Style;\n\n    return Utils;\n}]);\n\n/*global angular*/\n\napp.factory('WebWorker', ['$q', '$http', function ($q, $http) {\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\n    if (!isWebWorkerSupported) {\n        window.Worker = function () {\n            function Worker(src) {\n                var self = this;\n                $http.get(src, { transformResponse: function (d, h) { return d } }).then(function success(response) {\n                    try {\n                        eval('self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\\n ' + response.data + ' };');\n                        self.object = new self.o();\n                        self.object.postMessage = function (e) {\n                            self.onmessage({data:e});\n                        }\n                    } catch(e) {\n                        console.log(\"Worker error \", e);\n                    }\n                }, function error(response) {\n                    console.log(\"Worker not found\");\n                });\n            }\n            Worker.prototype = {\n                onmessage: function (e) {\n                    console.log('Worker not implemented');\n                },\n                postMessage: function (e) {\n                    this.object.onmessage({ data: e });\n                }\n            }\n            return Worker;\n        } ();\n    }\n    function WebWorker(src) {\n        var self = this;\n        this.callbacks = {};\n        this.id = 0;\n        this.worker = new Worker(src);\n        this.worker.onmessage = function (e) {\n            self.onmessage(e);\n        };\n    }\n    WebWorker.prototype = {\n        parse: function (e) {\n            return JSON.parse(e.data);\n        },\n        stringify: function (data) {\n            return JSON.stringify(data);\n        },\n        onmessage: function (e) {\n            var data = this.parse(e);\n            var deferred = this.callbacks[data.id];\n            if (data.status !== -1) {\n                deferred.resolve(data);\n            } else {\n                deferred.reject(data);\n            }\n            delete this.callbacks[data.id];\n        },\n        post: function (data) {\n            var deferred = $q.defer();\n            data.id = this.id;\n            this.callbacks[this.id.toString()] = deferred;\n            this.id++;\n            this.worker.postMessage(this.stringify(data));\n            return deferred.promise;\n        },\n    };\n    WebWorker.isSupported = isWebWorkerSupported;\n    return WebWorker;\n}]);\n\napp.factory('$httpAsync', ['$q', '$http', function ($q, $http) {\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\n    if (!isWebWorkerSupported) {\n        return $http;\n    }\n    var worker = new Worker('/js/workers/http.min.js');\n    var callbacks = {};\n    var id = 0;\n    var lowercase = function (string) { return isString(string) ? string.toLowerCase() : string; };\n    var trim = function (value) {\n        return isString(value) ? value.trim() : value;\n    };\n    function $httpAsync(options) {\n        var deferred = $q.defer();\n        var wrap = getDefaults(options);\n        wrap.id = id.toString();\n        console.log('wrap', wrap);\n        callbacks[wrap.id] = deferred;\n        id++;\n        worker.postMessage($httpAsync.stringify(wrap));\n        return deferred.promise;\n    }\n    $httpAsync.get = function (url, config) {\n        return $httpAsync(angular.extend({}, config || {}, {\n            method: 'GET',\n            url: url\n        }));\n    };\n    $httpAsync.delete = function (url, config) {\n        return $httpAsync(angular.extend({}, config || {}, {\n            method: 'DELETE',\n            url: url\n        }));\n    };\n    $httpAsync.head = function (url, config) {\n        return $httpAsync(angular.extend({}, config || {}, {\n            method: 'HEAD',\n            url: url\n        }));\n    };\n    $httpAsync.post = function (url, data, config) {\n        return $httpAsync(angular.extend({}, config || {}, {\n            method: 'POST',\n            data: data,\n            url: url\n        }));\n    };\n    $httpAsync.put = function (url, data, config) {\n        return $httpAsync(angular.extend({}, config || {}, {\n            method: 'PUT',\n            data: data,\n            url: url\n        }));\n    };\n    $httpAsync.patch = function (url, data, config) {\n        return $httpAsync(angular.extend({}, config || {}, {\n            method: 'PATCH',\n            data: data,\n            url: url\n        }));\n    };\n    $httpAsync.parse = function (e) {\n        return JSON.parse(e.data);\n    };\n    $httpAsync.stringify = function (data) {\n        return JSON.stringify(data);\n    };\n    $httpAsync.isSupported = isWebWorkerSupported;\n    worker.onmessage = function (e) {\n        var wrap = $httpAsync.parse(e);\n        console.log('onmessage', wrap);\n        var deferred = callbacks[wrap.id];\n        var status = wrap.status >= -1 ? wrap.status : 0;\n        var getter = headersGetter(wrap.response.headers);\n        (isSuccess(status) ? deferred.resolve : deferred.reject)({\n            data: wrap.response.data, // !!!! JSON.parse(wrap.response.data),\n            headers: getter,\n            status: wrap.response.status,\n            statusText: wrap.response.statusText,\n            config: wrap.config,\n        });\n        delete callbacks[wrap.id];\n    }\n    return $httpAsync;\n    function isSuccess(status) {\n        return 200 <= status && status < 300;\n    }\n    function createMap() {\n        return Object.create(null);\n    }\n    function isString(value) { return typeof value === 'string'; }\n    function parseHeaders(headers) {\n        var parsed = createMap(), i;\n        function fillInParsed(key, val) {\n            if (key) {\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\n            }\n        }\n        if (isString(headers)) {\n            var a = headers.split('\\n');\n            for (var j = 0; j < a.length; j++) {\n                var line = a[j];\n                i = line.indexOf(':');\n                fillInParsed(lowercase(trim(line.substr(0, i))), trim(line.substr(i + 1)));\n            }\n        } else if (isObject(headers)) {\n            for (var p in headers) {\n                fillInParsed(lowercase(p), trim(headers[p]));\n            }\n        }\n        return parsed;\n    }\n    function headersGetter(headers) {\n        var headersObj;\n        return function (name) {\n            if (!headersObj) headersObj = parseHeaders(headers);\n            if (name) {\n                var value = headersObj[lowercase(name)];\n                if (value === void 0) {\n                    value = null;\n                }\n                return value;\n            }\n            return headersObj;\n        };\n    }\n    function getDefaults(options) {\n        var defaults = {\n            method: 'GET',\n            withCredentials: false,\n            responseType: 'json',\n            headers: {},\n            config: {}\n        }\n        defaults.withCredentials = $http.defaults.withCredentials;\n        angular.extend(defaults.headers, $http.defaults.headers.common);\n        var method = (options.method || defaults.method).toLowerCase();\n        if ($http.defaults.headers[method]) {\n            angular.extend(defaults.headers, $http.defaults.headers[method]);\n        }\n        console.log('defaults', $http.defaults);\n        // defaults = angular.extend(defaults, $http.defaults);\n        /*\n    method{string}:                     HTTP method (e.g. 'GET', 'POST', etc)\n    url:{string}:                       Absolute or relative URL of the resource that is being requested.\n    params:{Object.<string|Object>}:    Map of strings or objects which will be serialized with the paramSerializer and appended as GET parameters.\n\n    data:{string|Object}:               Data to be sent as the request message data.\n    headers:{Object}:                   Map of strings or functions which return strings representing HTTP headers to send to the server. If the return value of a function is null, the header will not be sent. Functions accept a config object as an argument.\n\n    xsrfHeaderName:{string}:            Name of HTTP header to populate with the XSRF token.\n    xsrfCookieName:{string}:            Name of cookie containing the XSRF token.\n    transformRequest:{function(data, headersGetter)|Array.<function(data, headersGetter)>}:         transform function or an array of such functions. The transform function takes the http request body and headers and returns its transformed (typically serialized) version. See Overriding the Default Transformations\n\n    transformResponse:{function(data, headersGetter, status)|Array.<function(data, headersGetter, status)>}:    transform function or an array of such functions. The transform function takes the http response body, headers and status and returns its transformed (typically deserialized) version. See Overriding the Default TransformationjqLiks\n\n    paramSerializer:{string|function(Object<string,string>):string}:        A function used to prepare the string representation of request parameters (specified as an object). If specified as string, it is interpreted as function registered with the $injector, which means you can create your own serializer by registering it as a service. The default serializer is the $httpParamSerializer; alternatively, you can use the $httpParamSerializerJQLike\n\n    cache:{boolean|Cache}:              If true, a default $http cache will be used to cache the GET request, otherwise if a cache instance built with $cacheFactory, this cache will be used for caching.\n\n    timeout:{number|Promise}:           timeout in milliseconds, or promise that should abort the request when resolved.\n    withCredentials:{boolean}:          whether to set the withCredentials flag on the XHR object. See requests with credentials for more information.\n\n    responseType:{string}:              see XMLHttpRequest.responseType.\n        */\n        options ? options = angular.extend(defaults, options) : defaults;\n        return options;\n    }\n}]);\n"],"sourceRoot":"/source/"}