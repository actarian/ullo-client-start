{"version":3,"sources":["wwwroot/js/app.js"],"names":["app","angular","module","animation","$rootScope","$animate","isFirstView","currentRoute","isBackward","previousRoute","isForward","bezierOptions","type","dynamics","bezier","points","x","y","cp","duration","$on","event","current","previous","$$route","enter","element","done","css","translateY","opacity","scale","animate","w","offsetWidth","translateX","leave","setTimeout","LESSON","CONFIG","CLIENT","window","location","href","indexOf","API","FACEBOOK_APP_ID","assetTypeEnum","Unknown","Picture","IOS","navigator","userAgent","match","constant","config","$routeProvider","$locationProvider","when","title","templateUrl","controller","controllerAs","resolve","user","Users","isLoggedOrGoTo","otherwise","html5Mode","$httpProvider","defaults","withCredentials","run","$window","APP","route","size","standalone","document","ontouchmove","preventDefault","oncontextmenu","stopPropagation","getPictures","model","src","pictures","i","length","media","getPicture","picture","broadcast","params","$broadcast","$scope","$timeout","$http","$location","input2Options","name","id","get","then","response","data","error","console","log","signin","signinFormError","signinFormBusy","clicked","post","success","path","message","label","item","userName","facebookId","dish","price","isVeganFriendly","yes","no","created","vote","dishId","like","categories","key","guid","loadStream","items","$q","FacebookService","signOut","logoutBusy","all","signout","logout","goStream","goPost","goDish","goCategory","categoryId","goUser","userRoute","goSettings","signinOrSignup","auth","splashBusy","signInWithFacebook","useFacebook","getLoginStatus","authResponse","showFacebookLoginButton","showLoginButton","onFacebookLogin","login","onLogin","getFacebookMe","me","email","firstName","first_name","lastName","last_name","facebookPicture","url","facebookToken","accessToken","signup","signupFormError","signupFormBusy","DataSource","Posts","Upload","filters","search","source","service","paging","onUploadFileSelected","file","newFiles","$root","pictureBase64","dataUrl","Categories","DishesAutocomplete","dishesAutocomplete","hasPicture","has","pictureError","onDishSelected","submitPost","postFormBusy","postFormError","add","status","statusText","$routeParams","Dishes","detail","category","Category","UserName","currentUser","DishesTest","directive","Animate","Point","Icon","Utils","link","scope","attributes","onDown","e","pow","onMove","point","getTouch","local","getRelativeTouch","speed","distance","canvas","width","height","Math","min","max","mouse","addListeners","on","removeListeners","off","offsetHeight","ctx","getContext","maxItems","ticks","push","time","clearRect","d","PI","forEach","g","move","draw","play","onTap","addClass","removeClass","restrict","delays","undefined","split","delay","parseInt","removeClasses","join","shift","a","$parse","$compile","transclude","template","doTop","busy","onTop","$apply","sy","ey","undrag","doBottom","onBottom","lbottom2","inner","lbottom","padding","dragging","wheeling","down","removeDragListeners","bounce","ltop","redraw","abs","cy","pause","innerStyle","transform","toFixed","set","showIndicatorFor","percent","iy","indicator","ix","round","rows","html","count","indicatorStyle","loop","aKey","requestAnimationFrame","cancelAnimationFrame","addDragListeners","prev","onUp","up","_onWheel","dir","deltaY","wheelDelta","onWheel","ondragstart","$eval","find","Style","append","contents","throttle","ngImg","image","Image","onload","$set","this","load","$watch","newValue","WebWorker","worker","doWork","onImageLoaded","ngImgWorker","replace","form","placeholder","formKey","formFocus","required","readonly","control","options","number","canCreate","flatten","queryable","onSelected","MAX_ITEMS","getPhrase","Clear","phrase","input","val","Current","active","onTyping","Enter","onSelect","Up","Down","Parse","value","index","toLowerCase","NameA","substr","NameB","NameC","Filter","c","Search","setPhrase","onKeyDown","keyCode","onKeyUp","call","getClosest","target","onBlur","Init","init","Number","POSITIVE_INFINITY","onFocus","$parent","setItem","parsedItem","$item","$event","extend","$watchCollection","require","validateType","$parsers","unshift","$setValidity","String","toString","filter","$filter","legacyFilter","cost","currency","ratio","formatting","inches","unit","units","IMPERIAL","feet","floor","meters","cm","pounds","oz","kg","weight","grams","precision","format","timezone","parseTime","parseHour","factory","Base","prototype","$$super","$super","$ctor","apply","splice","arguments","constructor","methods","Object","create","Collection","collection","Array","inject","method","hasOwnProperty","fromArray","array","isArray","stringValue","addAll","radius","degree","h","sin","cos","fillStyle","fillRect","forcex","forcey","prevx","prevy","loadIcon","_this","loaded","random","repel","magnet","distancex","distancey","powerx","powery","drawImage","callback","playpause","Guest","User","Supervisor","Admin","UserRolesEnum","isAdmin","role","isUser","backgroundPicture","Dish","Post","upload","self","lastIndexOf","extension","uploadData","assetType","progress","uploads","JSON","stringify","concat","progressPercentage","total","voteCount","rating","ratingToString","votes","deferred","defer","reject","promise","onFacebookStatus","FB","facebook","api","fields","getPictureMe","deletePermissions","fbAsyncInit","appId","cookie","xfbml","version","s","js","fjs","getElementsByTagName","getElementById","createElement","parentNode","insertBefore","LocalStorage","_currentUser","getCurrentUser","isLogged","isAuthenticated","redirect","isAdminOrGoTo","uri","getRandomItems","uniqueId","TestSource","v","offset","DataFilter","getSearchParams","p","getParams","infinite","page","$httpAsync","maxPages","pages","pagination","getPages","bind","flush","PAGES_MAX","opened","responseHeader","headers","responseView","parse","refresh","more","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","Cookie","TIMEOUT","_set","days","date","Date","setTime","getTime","expires","toGMTString","cache","json","cookieName","ca","charAt","substring","checkCookie","elapsed","timeout","interval","isLocalStorageSupported","supported","localStorage","removeItem","isSupported","storageEvent","clearTimeout","originalEvent","Vector","make","b","sqrt","normalize","l","incidence","angle","atan2","cross","difference","towards","friction","copy","t","touch","touches","changedTouches","pageX","pageY","rect","getBoundingClientRect","left","top","el","selector","matchesFn","parent","some","fn","body","parentElement","func","wait","context","args","result","later","leading","getNow","now","remaining","trailing","lastTime","vendors","currTime","timeToCall","transformProperty","safariPropertyHack","div","style","every","prefix","props","hoverScale","currentScale","styles","cssText","transformOrigin","callbacks","Worker","onmessage","isWebWorkerSupported","transformResponse","eval","object","o","postMessage","wrap","getDefaults","isSuccess","createMap","isString","parseHeaders","fillInParsed","parsed","j","line","lowercase","trim","isObject","headersGetter","headersObj","responseType","common","string","head","put","patch","getter"],"mappings":"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","file":"wwwroot/js/app.min.js","sourcesContent":["/*global angular,FB */\r\n\r\nvar app = angular.module('ullo', ['ngRoute', 'ngAnimate', 'ngMessages', 'relativeDate', 'ngFileUpload']);\r\n\n/*global angular,dynamics*/\r\n\r\napp.animation('.navigation', ['$rootScope', '$animate', function($rootScope, $animate) {\r\n    \r\n    var previousRoute = null;\r\n    var currentRoute = null;\r\n    var bezierOptions = {\r\n        type: dynamics.bezier,\r\n        points: [{ x: 0, y: 0, cp: [{ x: 0.509, y: 0.007 }] }, { x: 1, y: 1, cp: [{ x: 0.566, y: 0.997 }] }],\r\n        duration: 500,\r\n    }\r\n    \r\n    $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        previousRoute = previous.$$route;\r\n        currentRoute = current.$$route;\r\n    });\r\n    \r\n    function isFirstView() {\r\n        return !currentRoute;\r\n    }\r\n    function isBackward() {\r\n        return previousRoute && previousRoute.isForward;\r\n    }\r\n    return {\r\n        enter: function(element, done) {\r\n            if (isFirstView()) {\r\n                // FIRST ENTERING ANIMATION\r\n                dynamics.css(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 0,\r\n                    scale: 1.2,\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 1,\r\n                    scale: 1,\r\n                }, bezierOptions);\r\n            } else if (isBackward()) {\r\n                // BACKWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: -w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions);\r\n            } else {\r\n                // FORWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions);\r\n            }\r\n            done();\r\n        },\r\n        leave: function(element, done) {\r\n            if (isBackward()) {\r\n                // BACKWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: w\r\n                }, bezierOptions);\r\n            } else {\r\n                // FORWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: -w\r\n                }, bezierOptions);\r\n            }\r\n            setTimeout(done, 1000);\r\n        }\r\n    }\r\n}]);\n/*global angular,FB */\r\n\r\nvar LESSON = true;\r\nvar CONFIG = {\r\n    CLIENT: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? 'http://ulloclient.wslabs.it' : 'http://dev.ullowebapp:8081',\r\n    API: (LESSON || window.location.href.indexOf('http://ulloclient.wslabs.it') === 0) ? 'http://ulloapi.wslabs.it' : 'https://localhost:44302',\r\n    FACEBOOK_APP_ID: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? '1054303094614120' : '1062564893787940',\r\n    assetTypeEnum: {\r\n        Unknown: 0,\r\n        Picture: 1,\r\n    },\r\n    IOS: (navigator.userAgent.match(/iPad|iPhone|iPod/g) ? true : false),\r\n};\r\n\r\napp.constant('APP', CONFIG);\r\n\r\napp.config(['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {\r\n\r\n    // TEST ROUTING\r\n    $routeProvider.when('/signin-test', {\r\n        title: 'Sign In',\r\n        templateUrl: 'templates/tests/signin.html',\r\n        controller: 'SignInTestCtrl',\r\n        controllerAs: 'signinCtrl',\r\n\r\n    }).when('/stream-test', {\r\n        title: 'Stream Test',\r\n        templateUrl: 'templates/tests/stream.html',\r\n        controller: 'StreamTestCtrl',\r\n        controllerAs: 'streamTestCtrl',\r\n\r\n    }).when('/stream-test-2', {\r\n        title: 'Stream Test 2',\r\n        templateUrl: 'templates/tests/stream-2.html',\r\n        controller: 'StreamTestCtrl',\r\n        controllerAs: 'streamTestCtrl',\r\n\r\n    // UNSECURE ROUTING\r\n    }).when('/splash', {\r\n        title: 'Splash',\r\n        templateUrl: 'templates/splash.html',\r\n        controller: 'SplashCtrl',\r\n        controllerAs: 'splashCtrl',\r\n\r\n    }).when('/signin', {\r\n        title: 'Sign In',\r\n        templateUrl: 'templates/signin.html',\r\n        controller: 'SigninCtrl',\r\n        controllerAs: 'signinCtrl',\r\n\r\n    }).when('/signup', {\r\n        title: 'Sign Up',\r\n        templateUrl: 'templates/signup.html',\r\n        controller: 'SignupCtrl',\r\n        controllerAs: 'signupCtrl',\r\n\r\n    }).when('/404', {\r\n\r\n        title: 'Error 404',\r\n        templateUrl: '404.html',\r\n\r\n    // SECURE ROUTING\r\n    }).when('/stream', {\r\n        title: 'Stream',\r\n        templateUrl: 'templates/stream.html',\r\n        controller: 'StreamCtrl',\r\n        controllerAs: 'streamCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n\r\n    }).when('/dishes/:dishId', {\r\n        title: 'Dish',\r\n        templateUrl: 'templates/dish.html',\r\n        controller: 'DishCtrl',\r\n        controllerAs: 'dishCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/categories/:categoryId', {\r\n        title: 'Category',\r\n        templateUrl: 'templates/category.html',\r\n        controller: 'CategoryCtrl',\r\n        controllerAs: 'categoryCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/users/:userRoute', {\r\n        title: 'User',\r\n        templateUrl: 'templates/user.html',\r\n        controller: 'UserCtrl',\r\n        controllerAs: 'userCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/post', {\r\n        title: 'Add Post',\r\n        templateUrl: 'templates/post.html',\r\n        controller: 'PostCtrl',\r\n        controllerAs: 'postCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/settings', {\r\n        title: 'Settings',\r\n        templateUrl: 'templates/settings.html',\r\n        controller: 'SettingsCtrl',\r\n        controllerAs: 'settingsCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    });\r\n\r\n    $routeProvider.otherwise('/splash'); // stream\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(true);\r\n\r\n}]);\r\n\r\napp.config(['$httpProvider', function ($httpProvider) {\r\n    \r\n    $httpProvider.defaults.withCredentials = true;\r\n    \r\n}]);\r\n\r\napp.run(['$rootScope', '$window', 'APP', function ($rootScope, $window, APP) {\r\n\r\n    $rootScope.standalone = $window.navigator.standalone;\r\n\r\n    document.ontouchmove = function (event) {\r\n        event.preventDefault();\r\n    }\r\n\r\n    window.oncontextmenu = function (event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        return false;\r\n    };\r\n\r\n    function Picture(route, size) {\r\n        if (route.indexOf('http') === 0) {\r\n            return route;\r\n        } else if (size) {\r\n            return APP.API + route + '?media=' + size;\r\n        } else {\r\n            return APP.API + route;\r\n        }\r\n    }\r\n\r\n    $rootScope.getPictures = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.pictures) {\r\n            for (var i = 0; i < model.pictures.length; i++) {\r\n                var media = model.pictures[i];\r\n                if (media.route) {\r\n                    src = Picture(media.route, size);\r\n                    i = 100000;\r\n                }\r\n            }\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    $rootScope.getPicture = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.picture && model.picture.route) {\r\n            src = Picture(model.picture.route, size);\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    $rootScope.broadcast = function (event, params) {\r\n        $rootScope.$broadcast(event, params);\r\n    };\r\n\r\n}]);\n/*global angular,FB */\r\n\r\napp.controller('SignInTestCtrl', ['$scope', '$timeout', '$http', '$location', function ($scope, $timeout, $http, $location) {\r\n\r\n    $scope.model = {};\r\n\r\n    $scope.input2Options = [{\r\n        name: 'Option1',\r\n        id:1   \r\n    }, {\r\n        name: 'Option2',\r\n        id:2   \r\n    }]\r\n    \r\n    $http.get('http://ulloapi.wslabs.it/api/stream/anonymous').then(function(response){\r\n        $scope.input2Options = response.data;\r\n    }, function(error) {\r\n        console.log('error', error);\r\n    });\r\n\r\n    $scope.signin = function () {\r\n        $scope.signinFormError = null;\r\n        $scope.signinFormBusy = true;\r\n        $scope.clicked = true;\r\n        $timeout(function() {\r\n            $http.post('http://ulloapi.wslabs.it/api/users/signin', $scope.model).then(function(success) {\r\n                console.log('signin', success);\r\n                $location.path('/stream-test');\r\n            }, function(error) {\r\n                console.log('error', error);\r\n                $scope.signinFormError = { message: error.message };\r\n            }).finally(function() {\r\n                $timeout(function() {\r\n                    $scope.signinFormBusy = false;\r\n                }, 3000);\r\n            });\r\n            $scope.clicked = false;\r\n        }, 1000);\r\n    };\r\n    \r\n}]);\r\n    \r\napp.controller('StreamTestCtrl', ['$scope', '$timeout', '$http', function ($scope, $timeout, $http) {\r\n\r\n    $scope.model = {\r\n        label: 'Carica',\r\n    };\r\n        \r\n    setTimeout(function() {\r\n        $scope.model.label = 'Carica Stream';\r\n    }, 1000);\r\n\r\n    $scope.item = {\r\n        id: 117,\r\n        user: {\r\n            userName: 'Fabio Ottaviani',\r\n            facebookId: '10153341954226947',\r\n            route: 'fabio-ottaviani'\r\n        },\r\n        dish: {\r\n            price: 5,\r\n            isVeganFriendly: false,\r\n            yes: 1,\r\n            no: 0,\r\n            created: '2016-04-27T19:13:45.497',\r\n            vote: {\r\n                dishId: 19,\r\n                like: true,\r\n                created: '2016-04-27T19:14:00.497'\r\n            },\r\n            categories: [\r\n                {\r\n                    id: 2,\r\n                    name: 'Piadine',\r\n                    key: 'piadine'\r\n                }\r\n            ],\r\n            id: 19,\r\n            name: 'Pizza Margherita',\r\n            key: 'pizzaMargherita'\r\n        },\r\n        picture: {\r\n            guid: '8fe99743-4ed3-46de-ba13-2c1bd7a45ffe',\r\n            created: '2016-04-27T19:13:41.02',\r\n            id: 20,\r\n            name: '8fe99743-4ed3-46de-ba13-2c1bd7a45ffe',\r\n            route: '/Media/Files/8fe99743-4ed3-46de-ba13-2c1bd7a45ffe.jpg',\r\n            key: '8Fe997434Ed346DeBa132C1bd7a45ffe'\r\n        },\r\n        created: '2016-04-27T19:13:45.497'\r\n    };\r\n    \r\n    $scope.loadStream = function() {\r\n        $http.get('http://ulloapi.wslabs.it/api/stream/anonymous').then(function(response){\r\n            $scope.items = response.data;\r\n        }, function(error) {\r\n            console.log('error', error);\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', '$q', 'FacebookService', 'Users', function ($scope, $location, $q, FacebookService, Users) {\r\n\r\n    $scope.Users = Users;\r\n\r\n    $scope.signOut = function () {\r\n        if ($scope.logoutBusy) {\r\n            return;\r\n        }\r\n\t\t$scope.logoutBusy = true;\r\n\t\t$q.all([\r\n\t\t\tUsers.signout(),\r\n\t\t\tFacebookService.logout()\r\n\t\t]).then(function(data) {\r\n\t\t\t$location.path('/splash');\r\n\t\t}, function(error) {\r\n\t\t\tconsole.log('signOut.error', error);\r\n\t\t}).finally(function() {\r\n\t\t\t$scope.logoutBusy = false;\r\n\t\t});\r\n    };\r\n\r\n    $scope.goStream = function () {\r\n        $location.path('/stream');\r\n    };\r\n\r\n    $scope.goPost = function () {\r\n        $location.path('/post');\r\n    };\r\n\r\n    $scope.goDish = function (dishId) {\r\n        $location.path('/dishes/' + dishId);\r\n    };\r\n\r\n    $scope.goCategory = function (categoryId) {\r\n        $location.path('/categories/' + categoryId);\r\n    };\r\n\r\n    $scope.goUser = function (userRoute) {\r\n        $location.path('/users/' + userRoute);\r\n    };\r\n\r\n    $scope.goSettings = function () {\r\n        $location.path('/settings');\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SplashCtrl', ['$scope', '$location', '$timeout', '$window', 'FacebookService', 'Users', function ($scope, $location, $timeout, $window, FacebookService, Users) {\r\n\r\n    var useFacebook = false;\r\n\r\n    $scope.splashBusy = true;\r\n\r\n\t$timeout(function() {\r\n        if (useFacebook) {\r\n            FacebookService.getLoginStatus().then(function(success) {\r\n                console.log('SplashCtrl.getLoginStatus.success', success.authResponse);\r\n                signinOrSignup(success.authResponse);\r\n\r\n            }, function(error) {\r\n                console.log('SplashCtrl.getLoginStatus.error', error);\r\n                $scope.showFacebookLoginButton = true;\r\n\r\n            }).finally(function() {\r\n                $scope.splashBusy = false;\r\n            });\r\n        } else {\r\n            $scope.showLoginButton = true;\r\n            $scope.splashBusy = false;\r\n        }\r\n\t}, 1000);\r\n\r\n    function signinOrSignup(auth) {\r\n        $scope.splashBusy = true;\r\n        Users.signInWithFacebook(auth).then(function(success) {\r\n            $location.path('/stream');\r\n        }, function(error) {\r\n            $location.path('/signup');\r\n        }).finally(function() {\r\n            $scope.splashBusy = false;\r\n        });\r\n    }\r\n\r\n    $scope.onFacebookLogin = function() {\r\n        $scope.splashBusy = true;\r\n        FacebookService.login().then(function(success) {\r\n            signinOrSignup(success.authResponse);\r\n        }, function(error) {\r\n            console.log('onFacebookLogin', error);\r\n        }).finally(function() {\r\n            $scope.splashBusy = false;\r\n        });\r\n    };\r\n\r\n    $scope.onLogin = function() {\r\n        $location.path('/signin');\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SigninCtrl', ['$scope', '$location', 'Users', 'FacebookService', function ($scope, $location, Users, FacebookService) {\r\n\r\n    $scope.model = {};\r\n\r\n    $scope.signin = function () {\r\n        $scope.signinFormError = null;\r\n        $scope.signinFormBusy = true;\r\n        Users.signin($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signinFormError = error.message;\r\n        }).finally(function () {\r\n            $scope.signinFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SignupCtrl', ['$scope', '$location', 'FacebookService', 'Users', function ($scope, $location, FacebookService, Users) {\r\n\r\n    FacebookService.getFacebookMe().then(function(me) {\r\n        console.log('SignupCtrl.getFacebookMe', me);\r\n        $scope.model = {\r\n            userName : me.name,\r\n            email : me.email,\r\n            firstName : me.first_name,\r\n            lastName : me.last_name,\r\n            facebookId : me.id,\r\n            facebookPicture : me.picture.data.url,\r\n            facebookToken : FacebookService.authResponse.accessToken,\r\n        };\r\n    }, function(error) {\r\n        console.log('SignupCtrl.getFacebookMe.error', error);\r\n    });\r\n\r\n    $scope.signup = function () {\r\n        console.log('SignupCtrl.signup', $scope.model);\r\n        $scope.signupFormError = null;\r\n        $scope.signupFormBusy = true;\r\n        Users.signup($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signupFormError = error.data.message;\r\n        }).finally(function () {\r\n            $scope.signupFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('StreamCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'Posts', 'Upload', function ($scope, $location, $timeout, DataSource, Posts, Upload) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n\r\n    $scope.source = new DataSource({\r\n        service: Posts,\r\n        filters: $scope.filters\r\n    });\r\n\r\n    $scope.source.paging();\r\n\r\n    console.log('paging');\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {\r\n        if (!file) {\r\n            return;\r\n        }\r\n        $scope.$root.pictureBase64 = null;\r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.$root.pictureBase64 = url;\r\n            $location.path('/post');\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('PostCtrl', ['$scope', '$timeout', '$location', 'Upload', 'Categories', 'Posts', 'DishesAutocomplete', function ($scope, $timeout, $location, Upload, Categories, Posts, DishesAutocomplete) {\r\n\r\n    Categories.get().then(function(categories) {\r\n        $scope.categories = categories;\r\n    })\r\n\r\n    $scope.dishesAutocomplete = new DishesAutocomplete();\r\n\r\n    $scope.model = {\r\n        pictureBase64: $scope.$root.pictureBase64 || null,\r\n        dish: {\r\n            categories: [],\r\n        }\r\n    };\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {\r\n        $scope.model.pictureBase64 = null;\r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.model.pictureBase64 = url;\r\n        });\r\n    };\r\n\r\n    $scope.hasPicture = function () {\r\n        var has = $scope.model.pictureBase64 !== null;\r\n        $scope.pictureError = true;\r\n        $timeout(function () {\r\n            $scope.pictureError = false;\r\n        }, 1000);\r\n        return has;\r\n    };\r\n\r\n    $scope.onDishSelected = function(item) {\r\n        console.log('onDishSelected', item);\r\n        $scope.model.dish.id = item.id;\r\n        $scope.model.dish.price = item.price;\r\n        $scope.model.dish.categories = item.categories;\r\n        $scope.model.dish.isVeganFriendly = item.isVeganFriendly;\r\n    };\r\n\r\n    $scope.submitPost = function () {\r\n        console.log('PostCtrl.submitPost', $scope.model);\r\n        $scope.postFormBusy = true;\r\n        $scope.postFormError = null;\r\n        $timeout(function () {\r\n            Posts.add($scope.model).then(function(post) {\r\n                $scope.model.id = post.id;\r\n                $location.path('/stream');\r\n            }, function(error) {\r\n                $scope.postFormError = error.config.url + ' ' + error.status + ' ' + error.statusText;\r\n            }).finally(function(){\r\n                $scope.postFormBusy = false;\r\n            });\r\n        }, 1);\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DishCtrl', ['$scope', '$routeParams', 'Dishes', function ($scope, $routeParams, Dishes) {\r\n\r\n    Dishes.detail($routeParams.dishId).then(function(item) {\r\n       $scope.item = item;\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('CategoryCtrl', ['$scope', '$routeParams', 'Categories', 'DataSource', 'Dishes', function ($scope, $routeParams, Categories, DataSource, Dishes) {\r\n\r\n    Categories.detail($routeParams.categoryId).then(function(category) {\r\n       $scope.category = category;\r\n\r\n       $scope.filters = {\r\n            search: {\r\n                Category: category.name\r\n            }\r\n        };\r\n\r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n\r\n        $scope.source.paging();\r\n\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('UserCtrl', ['$scope', '$routeParams', 'Users', 'DataSource', 'Dishes', function ($scope, $routeParams, Users, DataSource, Dishes) {\r\n\r\n    Users.detail($routeParams.userRoute).then(function(user) {\r\n       $scope.user = user;\r\n\r\n       $scope.filters = {\r\n            search: {\r\n                UserName: user.userName\r\n            }\r\n        };\r\n\r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n\r\n        $scope.source.paging();\r\n\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('SettingsCtrl', ['$scope', '$routeParams', 'Users', function ($scope, $routeParams, Users) {\r\n\r\n    $scope.user = Users.currentUser();\r\n\r\n}]);\r\n\r\napp.controller('DishTestCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'DishesTest', function ($scope, $location, $timeout, DataSource, DishesTest) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n\r\n    $scope.source = new DataSource({\r\n        service: DishesTest,\r\n        filters: $scope.filters\r\n    });\r\n\r\n    $timeout(function() {\r\n        $scope.source.paging();\r\n    }, 1000);\r\n\r\n}]);\r\n\n/*global angular,FB,dynamics*/\r\n\r\napp.directive('backgroundSplash', ['Animate', 'Point', 'Icon', 'Utils', function (Animate, Point, Icon, Utils) {\r\n    return {\r\n        link: function (scope, element, attributes, model) {\r\n            var canvas = element[0];\r\n            canvas.width = canvas.offsetWidth;\r\n            canvas.height = canvas.offsetHeight;\r\n            var ctx = canvas.getContext('2d');\r\n\r\n            var items = [], maxItems = 18, pow = 0, speed = 1, ticks = 0, mouse = null;\r\n            while(items.length < maxItems) {\r\n                items.push(new Icon());\r\n            }\r\n\r\n            var animate = new Animate(function draw(time) { \r\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n                \r\n                ticks += speed;\r\n\r\n                var d = ticks / 1000 % (Math.PI * 2);\r\n                pow += (0 - pow) / 12;\r\n\r\n                angular.forEach(items, function(item, i) {\r\n                    var g = Math.PI * 2 / items.length * i;\r\n                    item.move(g + d, canvas.width, canvas.height, pow, mouse);\r\n                    item.draw(ctx);                    \r\n                });\r\n                /*\r\n                angular.forEach(items, function(item, i) {\r\n                    var d = Math.PI * 2 / items.length * i + time / 1000;\r\n                    item.move(d, canvas.width, canvas.height, pow);\r\n                    item.draw(ctx);\r\n                });\r\n                */\r\n            });\r\n\r\n            function onDown(e) {\r\n                console.log('onDown');\r\n                pow = 1;\r\n                // animate.playpause();\r\n            }\r\n            function onMove(e) {\r\n                // console.log('onMove');\r\n                var point = Utils.getTouch(e);\r\n                var local = Utils.getRelativeTouch(element, point);\r\n                speed = (250 - local.distance({ x: canvas.width / 2, y: canvas.height / 2 })) / 5;\r\n                speed = Math.min(40, Math.max(10, speed));\r\n                mouse = local;\r\n            }\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onDown);\r\n                element.on('touchmove mousemove', onMove);\r\n            }\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onDown);\r\n                element.off('touchmove mousemove', onMove);\r\n            }\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n            animate.play();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('backgroundSplashFull', ['Utils', 'Animate', 'Point', 'Icon', function (Utils, Animate, Point, Icon) {\r\n    return {\r\n        link: function (scope, element, attributes, model) {\r\n            var canvas = element[0];\r\n            canvas.width = canvas.offsetWidth;\r\n            canvas.height = canvas.offsetHeight;\r\n            var ctx = canvas.getContext('2d');\r\n            /*\r\n            ctx.mozImageSmoothingEnabled = false;\r\n            ctx.webkitImageSmoothingEnabled = false;\r\n            ctx.msImageSmoothingEnabled = false;\r\n            ctx.imageSmoothingEnabled = false;\r\n            */\r\n            var maxItems = 18, pow = 0, speed = 1, ticks = 0, mouse = null;\r\n\r\n            var items = [];\r\n            while(items.length < maxItems) {\r\n                items.push(new Icon());\r\n            }\r\n\r\n            var animate = new Animate(function draw(time) {\r\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n                \r\n                ticks += speed;\r\n\r\n                var d = ticks / 1000 % (Math.PI * 2);\r\n                pow += (0 - pow) / 12;\r\n\r\n                angular.forEach(items, function(item, i) {\r\n                    var g = Math.PI * 2 / items.length * i;\r\n                    item.move(g + d, canvas.width, canvas.height, pow, mouse);\r\n                    item.draw(ctx);                 \r\n                });\r\n                /*                \r\n                ctx.fillStyle = \"white\";\r\n                for(var i = 0; i < 50; i++) {\r\n                    var g = Math.PI * 2 / 50 * i;\r\n                    ctx.fillRect(canvas.width / 2 + 100 * Math.sin(g + d), canvas.height / 2 + 100 * Math.cos(g + d), 4, 4);\r\n                }\r\n                */\r\n            });\r\n            /*\r\n            var aKey;\r\n            function draw(time) {\r\n                var d = time / 1000 % (Math.PI * 2);\r\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n                ctx.fillStyle = \"white\";\r\n                for(var i = 0; i < 50; i++) {\r\n                    var g = Math.PI * 2 / 50 * i;\r\n                    ctx.fillRect(canvas.width / 2 + 100 * Math.sin(g + d), canvas.height / 2 + 100 * Math.cos(g + d), 4, 4);\r\n                }\r\n            }\r\n            function play() {\r\n                function loop(time) {\r\n                    draw(time);\r\n                    aKey = window.requestAnimationFrame(loop, element);\r\n                }\r\n                if (!aKey) {\r\n                    loop();\r\n                }\r\n            }\r\n            function pause() {\r\n                if (aKey) {\r\n                    window.cancelAnimationFrame(aKey);\r\n                    aKey = null;\r\n                    // console.log('Animation.paused');\r\n                }\r\n            }\r\n            function playpause() {\r\n                if (aKey) {\r\n                    pause();\r\n                } else {\r\n                    play();\r\n                }\r\n            }\r\n            */\r\n            function onDown(e) {\r\n                // console.log('onDown');\r\n                pow = 1;\r\n            }\r\n            function onMove(e) {\r\n                // console.log('onMove');\r\n                var point = Utils.getTouch(e);\r\n                var local = Utils.getRelativeTouch(element, point);\r\n                speed = (250 - local.distance({ x: canvas.width / 2, y: canvas.height / 2 })) / 5;\r\n                speed = Math.min(40, Math.max(10, speed));\r\n                mouse = local;\r\n                // pow = 1;\r\n            }\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onDown);\r\n                element.on('touchmove mousemove', onMove);\r\n            }\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onDown);\r\n                element.off('touchmove mousemove', onMove);\r\n            }\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n            animate.play();\r\n        }\r\n    }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name onTap\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'tapped' on element and removes it after a timeout of 500 ms\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <button type=\"button\" on-tap>Tap me!</button>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .tapped {\r\n            background: red;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('onTap', ['$timeout', function ($timeout) {\r\n    return {\r\n        link: function (scope, element, attributes, model) {\r\n            function onTap(e) {\r\n                console.log(attributes);\r\n                element.addClass('tapped');\r\n                $timeout(function () {\r\n                    element.removeClass('tapped');\r\n                }, 500)\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name animate\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'animated' on element\r\n   *\r\n   * @param {string} [animate=fadeIn] a comma separated animate.css class names\r\n   * @param {string} [delay=1] a comma separated durations list in milliseconds\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div type=\"button\" animate=\"fadeInUp\" delay=\"1000\">\r\n            I'm an animated div.\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('animate', ['$timeout', function ($timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            element.addClass('animated');\r\n            var animate = ['fadeIn'], delays = ['1'];\r\n            if (attributes.animate !== undefined) {\r\n                animate = attributes.animate.split(',');\r\n            }\r\n            if (attributes.delay !== undefined) {\r\n                delays = attributes.delay.split(',');\r\n            }\r\n            angular.forEach(delays, function (d, i) {\r\n                delays[i] = parseInt(d);\r\n            });\r\n            while (delays.length < animate.length) {\r\n                delays.push(delays[delays.length - 1] + 50);\r\n            }\r\n            var removeClasses = animate.join(' ');\r\n            if (animate[0].indexOf('In') !== -1) {\r\n                element.addClass('invisible');\r\n                removeClasses += ' invisible';\r\n            }\r\n            while (animate.length) {\r\n                var d = delays.shift();\r\n                var a = animate.shift();\r\n                $timeout(function () {\r\n                    element.removeClass(removeClasses);\r\n                    element.addClass(a);\r\n                    if (animate.length === 0 && a.indexOf('Out') !== -1) {\r\n                        $timeout(function () {\r\n                            element.addClass('invisible');\r\n                        }, 1000);\r\n                    }\r\n                }, d);\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name scrollable\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Scrollable div 3d accellerated with touch functionality and callbacks for infinite scroll\r\n   *\r\n   * @param {promise} [on-top] optional callback function that execute when reaching top\r\n   * @param {promise} [on-bottom] optional callback function that execute when reaching bottom\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div ng-controller=\"TestCtrl\">\r\n            <section scrollable on-top=\"$root.doRefresh()\">\r\n                <ul>\r\n                    <li ng-repeat=\"item in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]\">item <span ng-bind=\"item\"></span></li>\r\n                </ul>\r\n            </section>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.controller('TestCtrl', ['$scope', '$q', function($scope, $q) {\r\n            $scope.doRefresh = function() {\r\n               var deferred = $q.defer();\r\n               if ($scope.busy) {\r\n                  deferred.reject();\r\n               } else {\r\n                  $scope.busy = true;\r\n                  $timeout(function() {\r\n                     $scope.busy = false;\r\n                     deferred.resolve();\r\n                  }, 500);\r\n               }\r\n               return deferred.promise;\r\n            };\r\n         }]);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .scrollable.content {\r\n            height: 200px!important;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('scrollable', ['$parse', '$compile', '$window', '$timeout', 'Utils', function ($parse, $compile, $window, $timeout, Utils) {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        template: '<div class=\"inner unselectable\" unselectable=\"on\" ng-transclude></div>',\r\n        link: function (scope, element, attributes, model) {\r\n            $window.ondragstart = function () { return false; };\r\n            // CONSTS;\r\n            var padding = 150;\r\n            // FLAGS;\r\n            var dragging, wheeling, busy;\r\n            // MOUSE;\r\n            var down, move, prev, up;\r\n            // COORDS;\r\n            var sy = 0, ey = 0, cy = 0, ltop = 0, lbottom = 0, speed = 0, ix = 45, iy = 0;\r\n            // ANIMATION KEY;\r\n            var aKey;\r\n            var onTop, onBottom, showIndicatorFor;\r\n            if (attributes.onTop !== undefined) {\r\n                onTop = $parse(attributes.onTop, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            if (attributes.onBottom !== undefined) {\r\n                onBottom = $parse(attributes.onBottom, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            if (attributes.showIndicatorFor !== undefined) {\r\n                showIndicatorFor = scope.$eval(attributes.showIndicatorFor); // $parse(attributes.showIndicatorFor, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            // console.log('showIndicatorFor', showIndicatorFor);\r\n            // ELEMENTS & STYLESHEETS;\r\n            element.addClass('scrollable content');            \r\n            // element.attr('unselectable', 'on').addClass('unselectable');\r\n            var inner = element.find('div');\r\n            var innerStyle = new Utils.Style();\r\n            var indicator = null, indicatorStyle;\r\n            if (showIndicatorFor) {\r\n                indicator = angular.element('<div class=\"indicator\"></div>');\r\n                indicatorStyle = new Utils.Style();\r\n                element.append(indicator);\r\n                $compile(indicator.contents())(scope);\r\n                indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n                indicatorStyle.set(indicator[0]);\r\n            }\r\n            function doTop() {\r\n                if (busy) {\r\n                    return;\r\n                }\r\n                if (!onTop) {\r\n                    return;\r\n                }\r\n                busy = true;\r\n                scope.$apply(onTop).then().finally(function () {\r\n                    sy = ey = 0;\r\n                    setTimeout(function () {\r\n                        undrag();\r\n                        busy = false;\r\n                    }, 500);\r\n                });\r\n            }\r\n            function doBottom() {\r\n                if (busy) {\r\n                    return;\r\n                }\r\n                if (!onBottom) {\r\n                    return;\r\n                }\r\n                busy = true;\r\n                scope.$apply(onBottom).then().finally(function () {\r\n                    var lbottom2 = element[0].offsetHeight - inner[0].offsetHeight;\r\n                    if (lbottom2 > lbottom) {\r\n                        sy = ey = lbottom;\r\n                    } else {\r\n                        sy = ey = lbottom + padding;\r\n                    }\r\n                    setTimeout(function () {\r\n                        undrag();\r\n                        busy = false;\r\n                    }, 500);\r\n                });\r\n            }\r\n            function undrag() {\r\n                // console.log('undrag');\r\n                dragging = false;\r\n                wheeling = false;\r\n                move = null;\r\n                down = null;\r\n                removeDragListeners();\r\n            }\r\n            function bounce() {\r\n                ltop += padding;\r\n                lbottom -= padding;\r\n                if (ey > ltop) {\r\n                    doTop();\r\n                } else if (ey < lbottom) {\r\n                    doBottom();\r\n                }\r\n            }\r\n            function redraw(time) {\r\n                // if (!busy) {\r\n                ltop = 0;\r\n                lbottom = element[0].offsetHeight - inner[0].offsetHeight;\r\n                if (dragging) {\r\n                    ey = sy + move.y - down.y;\r\n                    bounce();\r\n                } else if (speed) {\r\n                    ey += speed;\r\n                    speed *= .75;\r\n                    if (wheeling) {\r\n                        bounce();\r\n                    }\r\n                    if (Math.abs(speed) < 0.05) {\r\n                        speed = 0;\r\n                        ey = sy = cy;\r\n                        wheeling = false;\r\n                        pause();\r\n                    }\r\n                }\r\n                // }\r\n                ey = Math.min(ltop, ey);\r\n                ey = Math.max(lbottom, ey);\r\n                cy += (ey - cy) / 4;\r\n                innerStyle.transform('translate3d(0,' + cy.toFixed(2) + 'px,0)');\r\n                innerStyle.set(inner[0]);\r\n                if (showIndicatorFor) {\r\n                    if (dragging || wheeling || speed) {\r\n                        var percent = cy / (element[0].offsetHeight - inner[0].offsetHeight);\r\n                        percent = Math.max(0, Math.min(1, percent));\r\n                        iy = (element[0].offsetHeight - indicator[0].offsetHeight) * (percent);\r\n                        ix += (0 - ix) / 4;\r\n                        // var count = Math.round(inner[0].offsetHeight / 315);\r\n                        var i = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\r\n                        indicator.html(i + '/' + showIndicatorFor.count);\r\n                        // indicator.html((percent * 100).toFixed(2).toString());\r\n                    } else {\r\n                        ix += (45 - ix) / 4;\r\n                    }\r\n                    indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n                    indicatorStyle.set(indicator[0]);\r\n                }\r\n            }\r\n            function play() {\r\n                function loop(time) {\r\n                    redraw(time);\r\n                    aKey = window.requestAnimationFrame(loop, element);\r\n                }\r\n                if (!aKey) {\r\n                    loop();\r\n                }\r\n            }\r\n            function pause() {\r\n                if (aKey) {\r\n                    window.cancelAnimationFrame(aKey);\r\n                    aKey = null;\r\n                    // console.log('Animation.paused');\r\n                }\r\n            }\r\n            function onDown(e) {\r\n                if (!busy) {\r\n                    sy = ey = cy;\r\n                    speed = 0;\r\n                    down = Utils.getTouch(e);\r\n                    wheeling = false;\r\n                    // console.log(down);\r\n                    addDragListeners();\r\n                    play();\r\n                }\r\n            }\r\n            function onMove(e) {\r\n                prev = move;\r\n                move = Utils.getTouch(e);\r\n                dragging = true;\r\n                // console.log(move);\r\n            }\r\n            function onUp(e) {\r\n                if (move && prev) {\r\n                    speed += (move.y - prev.y) * 4;\r\n                }\r\n                sy = ey = cy;\r\n                dragging = false;\r\n                move = null;\r\n                down = null;\r\n                prev = null;\r\n                up = Utils.getTouch(e);\r\n                // console.log(up);\r\n                removeDragListeners();\r\n            }\r\n            function _onWheel(e) {\r\n                if (!busy) {\r\n                    if (!e) e = event;\r\n                    var dir = (((e.deltaY < 0 || e.wheelDelta > 0) || e.deltaY < 0) ? 1 : -1)\r\n                    /*\r\n                    var evt = window.event || e;\r\n                    var delta = evt.detail ? evt.detail * -120 : evt.wheelDelta\r\n                    speed += delta;\r\n                    */\r\n                    speed += dir * 5;\r\n                    wheeling = true;\r\n                    play();\r\n                }\r\n            }\r\n            var onWheel = Utils.throttle(_onWheel, 25);\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onDown);\r\n                element.on('wheel', onWheel);\r\n                // element.addEventListener('DOMMouseScroll',handleScroll,false); // for Firefox\r\n                // element.addEventListener('mousewheel',    handleScroll,false); // for everyone else\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onDown);\r\n                element.off('wheel', onWheel);\r\n            };\r\n            function addDragListeners() {\r\n                angular.element($window).on('touchmove mousemove', onMove);\r\n                angular.element($window).on('touchend mouseup', onUp);\r\n            };\r\n            function removeDragListeners() {\r\n                angular.element($window).off('touchmove mousemove', onMove);\r\n                angular.element($window).off('touchend mouseup', onUp);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        },\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImg\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img=\"'/img/nature-01.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('ngImg', ['$parse', '$timeout', function ($parse, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            var src = $parse(attributes.ngImg, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            var image = new Image();\r\n            image.onload = function () {\r\n                attributes.$set('src', this.src);\r\n                setTimeout(function () {\r\n                    element.addClass('loaded');\r\n                }, 10);\r\n            }\r\n            image.load = function (src) {\r\n                element.removeClass('loaded');\r\n                this.src = src;\r\n            }\r\n            scope.$watch(src, function (newValue) {\r\n                if (!newValue) {\r\n                    attributes.$set('src', null);\r\n                } else {\r\n                    image.load(newValue);\r\n                }\r\n            });\r\n        }\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImgWorker\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * As ngImg but using webworker. Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img-worker=\"'/img/nature-02.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n\t</example>\r\n*/\r\napp.directive('ngImgWorker', ['$parse', 'WebWorker', function ($parse, WebWorker) {\r\n    var worker = new WebWorker('/js/workers/loader.js');\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            function doWork(src) {\r\n                element.removeClass('loaded');\r\n                function onImageLoaded(src) {\r\n                    attributes.$set('src', src);\r\n                    setTimeout(function () {\r\n                        element.addClass('loaded');\r\n                    }, 100);\r\n                }\r\n                worker.post({ url: src }).then(function (data) {\r\n                    onImageLoaded(data.url);\r\n                }, function (error) {\r\n                    onImageLoaded(null);\r\n                });\r\n            }\r\n            var src = scope.$eval(attributes.ngImgWorker);\r\n            if (!src) {\r\n                attributes.$set('src', null);\r\n            } else {\r\n                doWork(src);\r\n            }\r\n        }\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name control\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Dinamic form control generator through templates with extended validation\r\n   *\r\n   * @param {string} model the target model of control\r\n   * @param {string} [control=text] the type of control, available types (text, password, email, number, checkbox, textarea, datetime-local, select, autocomplete)\r\n   * @param {string} [form=Form] the name of the form\r\n   * @param {string} [title=Untitled] the title of the control\r\n   * @param {string} [placeholder=title] the placeholder of the control\r\n   * @param {string} [source=null] datasource of select as array\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   * @param {string} [required=false] if the control is required\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"select\" title=\"category\" placeholder=\"select a category\" model=\"model.category\" source=\"[{name:'Main',id:1}, {name:'Second',id:2}]\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"number\" title=\"dish price\" placeholder=\"type the price of the dish\" model=\"model.dish.price\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"checkbox\" title=\"is vegan friendly\" placeholder=\"please check if the dish is vegan friendly\" model=\"model.dish.isVeganFriendly\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('control', [function () {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        template: function (element, attributes) {\r\n            var form = attributes.form || 'Form';\r\n            var title = attributes.title || 'Untitled';\r\n            var placeholder = attributes.placeholder || title;\r\n            var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('');\r\n            var formKey = form + '.' + name;\r\n            var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n            var required = '';\r\n            var label = (attributes.label ? attributes.label : 'name');\r\n            var key = (attributes.key ? attributes.key : 'id');\r\n            var model = attributes.model;\r\n            if (attributes.required) {\r\n                required = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + form + '.' + name + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> &larr; required</span>';\r\n                switch (attributes.control) {\r\n                    case 'password':\r\n                        required = required + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> &larr; at least 6 chars</span>';\r\n                        break;\r\n                    case 'email':\r\n                        required = required + '<span ng-message=\"email\" class=\"label-error animated flash\"> &larr; incorrect</span>';\r\n                        break;\r\n                    case 'number':\r\n                        required = required + '<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    required = required + '<span ng-message=\"match\" class=\"label-error animated flash\"> &larr; not matching</span>';\r\n                }\r\n                required = required + '</span>';\r\n            } else {\r\n                required = ' (optional)';\r\n            }\r\n            var template = '<div ' + (attributes.readonly ? ' class=\"readonly\" ' : '') + ' ng-class=\"{ focus: ' + formKey + '.hasFocus, success: ' + formKey + '.$valid, error: ' + formKey + '.$invalid && (form.$submitted || ' + formKey + '.$touched), empty: !' + formKey + '.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + required + '</label>';\r\n            switch (attributes.control) {\r\n                case 'checkbox':\r\n                    template = '<div class=\"checkbox\">';\r\n                    template += '<span class=\"checkbox-label\">' + title + required + '</span>';\r\n                    template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + (attributes.required ? 'required=\"true\"' : '') + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                    template += '</div>';\r\n                    break;\r\n                case 'select':\r\n                    var options = attributes.number\r\n                        ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source\r\n                        : 'item.' + label + ' for item in ' + attributes.source + ' track by item.' + key;\r\n                    template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + ' ' + (attributes.required ? 'required=\"true\"' : '') + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                    break;\r\n                case 'autocomplete':\r\n                    var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                    var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                    var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                    var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                    template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                    template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                    break;\r\n                case 'textarea':\r\n                    template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" ' + (attributes.required ? 'required' : '') + ' rows=\"' + (attributes.rows ? attributes.rows : '1') + '\"' + formFocus + '></textarea>';\r\n                    break;\r\n                case 'datetime-local':\r\n                    placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n                    break;\r\n                case 'password':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"6\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n                    break;\r\n                case 'email':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n                    break;\r\n                case 'number':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n                    break;\r\n                case 'text':\r\n                default:\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n                    break;\r\n            }\r\n            return template + '</div>';\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n        },\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name controlAutocomplete\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom control type with autocomplete functionality. (use the shortcut version with control directive)\r\n   *\r\n   * @param {service} controlAutocomplete the datasource service\r\n   * @param {model} model the target model of control\r\n   * @param {boolean} [canCreate=false] setted on true the control can add new entities\r\n   * @param {boolean} [flatten=false] set to true to flat the value to the model\r\n   * @param {boolean} [queryable=false] set to true if is a queryable service\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12 empty focus\">\r\n                     <label for=\"dishname\" class=\"control-label\">dish name<span ng-messages=\"(myForm.$submitted || myForm.dishname.$touched) &amp;&amp; myForm.dishname.$error\" role=\"alert\" class=\"ng-inactive\"></span></label>\r\n                     <input name=\"dishname\" ng-model=\"model.name\" type=\"hidden\" required=\"\">\r\n                     <div control-autocomplete=\"dishesAutocomplete\" model=\"model.name\" label=\"name\" key=\"name\" can-create=\"true\" flatten=\"true\" queryable=\"false\" placeholder=\"type the name of the dish\" on-focus=\"myForm.dishname.hasFocus=true\" on-blur=\"myForm.dishname.hasFocus=false\" on-selected=\"onDishSelected($item)\" class=\"ng-isolate-scope\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.run(['$rootScope', '$q', function($rootScope, $q) {\r\n            $rootScope.dishesAutocomplete = ;\r\n            $rootScope.onDishSelected = function($item) {\r\n               alert($item);\r\n            };\r\n         }]);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('controlAutocomplete', ['$parse', '$window', '$timeout', 'Utils', function ($parse, $window, $timeout, Utils) {\r\n    var MAX_ITEMS = 5;\r\n    return {\r\n        restrict: 'A',\r\n        scope: {\r\n            service: '=controlAutocomplete',\r\n            canCreate: '=',\r\n            flatten: '=',\r\n            queryable: '=',\r\n            model: '=',\r\n            label: '@',\r\n            key: '@',\r\n        },\r\n        template: function (element, attributes) {\r\n            var template = '<div>';\r\n            template += '   <input class=\"form-control\" ng-model=\"phrase\" ng-model-options=\"{ debounce: 150 }\" placeholder=\"' + attributes.placeholder + '\" type=\"text\" ng-focus=\"onFocus()\">';\r\n            template += '   <ul class=\"form-autocomplete\" ng-show=\"items.length\">';\r\n            template += '       <li ng-repeat=\"item in items\" ng-class=\"{ active: active == $index }\" ng-click=\"onSelect(item)\">';\r\n            template += '           <span>{{item.NameA}}<span class=\"token\">{{item.NameB}}</span>{{item.NameC}}</span>';\r\n            template += '       </li>';\r\n            template += '   </ul>';\r\n            template += '</div>';\r\n            return template;\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n            var onSelected = $parse(attributes.onSelected);\r\n            var input = element.find('input');\r\n            var label = (scope.label ? scope.label : 'name');\r\n            var key = (scope.key ? scope.key : 'id');\r\n            function getPhrase() {\r\n                if (scope.model) {\r\n                    return scope.flatten ? scope.model : scope.model[label];\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n            scope.phrase = getPhrase();\r\n            scope.count = 0;\r\n            scope.items = [];\r\n            scope.active = -1;\r\n            scope.maxItems = scope.maxItems || Number.POSITIVE_INFINITY;\r\n            function Clear(phrase) {\r\n                scope.items.length = 0;\r\n                scope.count = 0;\r\n                scope.phrase = phrase || null;\r\n                input.val(scope.phrase);\r\n            }\r\n            function Current() {\r\n                var current = null;\r\n                if (scope.active != -1 && scope.items.length > scope.active) {\r\n                    current = scope.items[scope.active];\r\n                }\r\n                return current;\r\n            }\r\n            scope.onFocus = function () {\r\n                if (attributes.onFocus !== undefined) {\r\n                    scope.$parent.$eval(attributes.onFocus);\r\n                }\r\n                if (input.val() === getPhrase()) {\r\n                    input.val(null);\r\n                }\r\n            };\r\n            scope.onBlur = function () {\r\n                if (attributes.onBlur !== undefined) {\r\n                    scope.$parent.$eval(attributes.onBlur);\r\n                }\r\n                Clear(getPhrase());\r\n            };\r\n            scope.onSelect = function (item) {\r\n                if (scope.queryable) {\r\n                    scope.service.setItem(item).then(function (parsedItem) {\r\n                        onSelected({ $item: parsedItem }, scope.$parent, { $event: {} });\r\n                        $timeout(function () {\r\n                            if (scope.flatten) {\r\n                                scope.model = parsedItem[key];\r\n                            } else {\r\n                                scope.model = scope.model || {};\r\n                                angular.extend(scope.model, parsedItem);\r\n                            }\r\n                            scope.onBlur();\r\n                        }, 1);\r\n                    });\r\n                } else {\r\n                    onSelected({ $item: item }, scope.$parent, { $event: {} });\r\n                    if (scope.flatten) {\r\n                        scope.model = item[key];\r\n                    } else {\r\n                        scope.model = scope.model || {};\r\n                        angular.extend(scope.model, item);\r\n                    }\r\n                    scope.onBlur();\r\n                }\r\n            };\r\n            function onTyping(phrase) {\r\n                if (scope.canCreate) {\r\n                    if (scope.flatten) {\r\n                        if (key === label) {\r\n                            scope.model = phrase;\r\n                        }\r\n                    } else {\r\n                        scope.model = {};\r\n                        scope.model[label] = phrase;\r\n                    }\r\n                }\r\n            };\r\n            function Enter() {\r\n                var item = Current();\r\n                if (item) {\r\n                    scope.onSelect(item);\r\n                }\r\n                scope.$apply();\r\n            }\r\n            function Up() {\r\n                scope.active--;\r\n                if (scope.active < 0) {\r\n                    scope.active = scope.items.length - 1;\r\n                }\r\n                scope.$apply();\r\n            }\r\n            function Down() {\r\n                scope.active++;\r\n                if (scope.items.length == 0) {\r\n                    scope.active = -1;\r\n                } else if (scope.active >= scope.items.length) {\r\n                    scope.active = 0;\r\n                }\r\n                scope.$apply();\r\n            }\r\n            function Parse(data) {\r\n                scope.items = data.items;\r\n                scope.count = data.count;\r\n                angular.forEach(scope.items, function (value, index) {\r\n                    var name = value[label];\r\n                    var i = name.toLowerCase().indexOf(scope.phrase.toLowerCase());\r\n                    value.NameA = name.substr(0, i);\r\n                    value.NameB = name.substr(i, scope.phrase.length);\r\n                    value.NameC = name.substr(i + scope.phrase.length, name.length - (i + scope.phrase.length));\r\n                });\r\n            }\r\n            function Filter(data) {\r\n                var c = 0, i = [];\r\n                if (scope.phrase.length > 1) {\r\n                    angular.forEach(data.items, function (value, index) {\r\n                        var name = value[label];\r\n                        if (name.toLowerCase().indexOf(scope.phrase.toLowerCase()) !== -1) {\r\n                            if (i.length < MAX_ITEMS) {\r\n                                i.push(value);\r\n                            }\r\n                            c++;\r\n                        }\r\n                    });\r\n                }\r\n                Parse({\r\n                    count: c,\r\n                    items: i\r\n                });\r\n            }\r\n            function Search() {\r\n                scope.phrase = input.val();\r\n                scope.active = -1;\r\n                onTyping(scope.phrase);\r\n                if (scope.queryable) {\r\n                    scope.service.setPhrase(scope.phrase).then(function (success) {\r\n                        scope.items = success.items;\r\n                        scope.count = success.count;\r\n                    }, function (error) {\r\n                        console.log('Search.queryable.error', scope.phrase, error);\r\n                    }).finally(function () {\r\n\r\n                    });\r\n                } else {\r\n                    Filter({\r\n                        count: scope.service.length,\r\n                        items: scope.service\r\n                    });\r\n                    scope.$apply();\r\n                }\r\n            }\r\n            function onKeyDown(e) {\r\n                switch (e.keyCode) {\r\n                    case 9: // Tab\r\n                    case 13: // Enter\r\n                        Enter();\r\n                        if (scope.items.length) {\r\n                            e.preventDefault ? e.preventDefault() : null;\r\n                            return false;\r\n                        }\r\n                        break;\r\n                    case 38: // Up\r\n                        Up();\r\n                        break;\r\n                    case 40: // Down\r\n                        Down();\r\n                        break;\r\n                }\r\n            }\r\n            function onKeyUp(e) {\r\n                switch (e.keyCode) {\r\n                    case 9: // Tab\r\n                    case 13: // Enter\r\n                        break;\r\n                    case 39: // Right\r\n                        break;\r\n                    case 37: // Left\r\n                        break;\r\n                    case 38: // Up\r\n                        break;\r\n                    case 40: // Down\r\n                        break;\r\n                    default: // Text\r\n                        Search.call(this);\r\n                        break;\r\n                }\r\n            }\r\n            function onUp(e) {\r\n                if (Utils.getClosest(e.target, '[control-autocomplete]') === null) {\r\n                    scope.$apply(function () {\r\n                        scope.onBlur();\r\n                    });\r\n                }\r\n                return true;\r\n            }\r\n            function addListeners() {\r\n                input.on('keydown', onKeyDown);\r\n                input.on('keyup', onKeyUp);\r\n                angular.element($window).on('mouseup touchend', onUp);\r\n            };\r\n            function removeListeners() {\r\n                input.off('keydown', onKeyDown);\r\n                input.off('keyup', onKeyUp);\r\n                angular.element($window).off('mouseup touchend', onUp);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            var init = false;\r\n            function Init() {\r\n                if (!init) {\r\n                    addListeners();\r\n                    init = true;\r\n                }\r\n            }\r\n            scope.$watch('service', function (newValue) {\r\n                if (newValue && (newValue.length || scope.queryable)) {\r\n                    Init();\r\n                }\r\n            });\r\n            scope.$watchCollection('model', function (newValue) {\r\n                if (newValue) {\r\n                    if (scope.flatten && label === key) {\r\n                        scope.phrase = newValue;\r\n                        input.val(scope.phrase);\r\n                    } else if (newValue[label]) {\r\n                        scope.phrase = newValue[label];\r\n                        input.val(scope.phrase);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n    };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name validateType\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom validation type for ngModel\r\n   *\r\n   * @param {string} [validateType=number] the type of custom validation\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n\t\t<file name=\"index.html\">\r\n\t\t\t<form name=\"myForm\">\r\n\t\t\t\t<input name=\"myValue\" type=\"text\" ng-model=\"model\" validate-type=\"number\" />\r\n\t\t\t\t<span ng-messages=\"(myForm.$submitted || myForm.$touched) && myForm.myValue.$error\" role=\"alert\">\r\n\t\t\t\t\t<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>\r\n\t\t\t\t</span>\r\n\t\t\t</form>\r\n\t\t</file>\r\n\t\t<file name=\"script.js\">\r\n\t\t\tangular.module('examples', ['wsUtils']);\r\n\t\t</file>\r\n\t</example>\r\n*/\r\napp.directive('validateType', function () {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var type = attributes.validateType;\r\n            switch (type) {\r\n                case 'number':\r\n                    model.$parsers.unshift(function (value) {\r\n                        model.$setValidity(type, String(value).indexOf(Number(value).toString()) !== -1);\r\n                        return value;\r\n                    });\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n});\n\r\napp.filter('customCurrency', ['$filter', function ($filter) {\r\n    var legacyFilter = $filter('currency');\r\n    return function (cost, currency) {\r\n        return legacyFilter(cost * currency.ratio, currency.formatting);\r\n    }\r\n}]);\r\n\r\napp.filter('customSize', ['APP', function (APP) {\r\n    return function (inches) {\r\n        if (APP.unit === APP.units.IMPERIAL) {\r\n            var feet = Math.floor(inches / 12);\r\n            inches = inches % 12;\r\n            inches = Math.round(inches * 10) / 10;\r\n            return (feet ? feet + '\\' ' : '') + (inches + '\\'\\'');\r\n        } else {\r\n            var meters = Math.floor(inches * APP.size.ratio);\r\n            var cm = (inches * APP.size.ratio * 100) % 100;\r\n            cm = Math.round(cm * 10) / 10;\r\n            return (meters ? meters + 'm ' : '') + (cm + 'cm');\r\n        }\r\n    };\r\n}]);\r\n\r\napp.filter('customWeight', ['APP', function (APP) {\r\n    return function (pounds) {\r\n        if (APP.unit === APP.units.IMPERIAL) {\r\n            if (pounds < 1) {\r\n                var oz = pounds * 16;\r\n                oz = Math.round(oz * 10) / 10;\r\n                return (oz ? oz + 'oz ' : '');\r\n            } else {\r\n                pounds = Math.round(pounds * 100) / 100;\r\n                return (pounds ? pounds + 'lb ' : '');\r\n            }\r\n        } else {\r\n            var kg = Math.floor(pounds * APP.weight.ratio / 1000);\r\n            var grams = (pounds * APP.weight.ratio) % 1000;\r\n            grams = Math.round(grams * 10) / 10;\r\n            return (kg ? kg + 'kg ' : '') + (grams + 'g');\r\n        }\r\n    };\r\n}]);\r\n\r\napp.filter('customNumber', ['$filter', function ($filter) {\r\n    var filter = $filter('number');\r\n    return function (value, precision, unit) {\r\n        unit = unit || '';\r\n        return (value ? filter(value, precision) + unit : '-');\r\n    }\r\n}]);\r\n\r\napp.filter('customDate', ['$filter', function ($filter) {\r\n    var filter = $filter('date');\r\n    return function (value, format, timezone) {\r\n        return value ? filter(value, format, timezone) : '-';\r\n    }\r\n}]);\r\n\r\napp.filter('customTime', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseTime(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customDigital', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseHour(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customString', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        return value ? value : (placeholder ? placeholder : '-');\r\n    }\r\n}]);\r\n\r\napp.filter('customEnum', function () {\r\n    return function (val) {\r\n        val = val + 1;\r\n        return val < 10 ? '0' + val : val;\r\n    };\r\n});\r\n\n/*global angular,FB */\r\n\r\napp.factory('Base', [function () {\r\n    function Base() {        \r\n    }\r\n    Base.prototype = {\r\n        $$super: null,\r\n        $super: {},\r\n        $ctor: function () {\r\n            this.$$super.apply(this, [].splice.call(arguments, 0));\r\n        },        \r\n    };\r\n    Base.extend = function (data) {\r\n        if (!data || !data.constructor) {\r\n            throw('Base.extend.error: please pass an object with constructor eg. { constructor: function myFunc() {...} }');\r\n        }\r\n        var constructor = data.constructor;\r\n        var methods = data.methods || {};\r\n        // statics\r\n        angular.extend(constructor, this);\r\n        // prototypes\r\n        constructor.prototype = angular.extend(Object.create(this.prototype), methods);\r\n        constructor.prototype.constructor = constructor;\r\n        constructor.prototype.$$super = this;\r\n        constructor.prototype.$super = {};\r\n        angular.forEach(this.prototype, function(value, key) {\r\n            constructor.prototype.$super[key] = function(scope) {\r\n                value.apply(scope, [].splice.call(arguments, 1));\r\n            };\r\n        });\r\n        return constructor;\r\n    };\r\n    Base.prototype.constructor = Base;\r\n    return Base;\r\n}]);\r\n\r\napp.factory('Collection', [function () {\r\n    function Collection() {\r\n        var collection = Object.create(Array.prototype);\r\n        collection = (Array.apply(collection, arguments) || collection);\r\n        this.constructor.inject(collection);\r\n        collection.init();\r\n        return (collection);\r\n    }\r\n    Collection.inject = function (collection) {\r\n        for (var method in this.prototype) {\r\n            // Make sure this is a local method.\r\n            if (this.prototype.hasOwnProperty(method)) {\r\n                collection[method] = this.prototype[method];\r\n            }\r\n        }\r\n        return (collection);\r\n    };\r\n    Collection.extend = function (prototype) {\r\n        var constructor = function () {\r\n            return Collection.apply(this, arguments);\r\n        }\r\n        // statics\r\n        angular.extend(constructor, this);\r\n        // prototypes\r\n        constructor.prototype = angular.extend({}, this.prototype, prototype);\r\n        constructor.prototype.constructor = constructor;\r\n        return constructor;\r\n    };\r\n    Collection.fromArray = function (array) {\r\n        var collection = Collection.apply(null, array);\r\n        return (collection);\r\n    };\r\n    Collection.isArray = function (value) {\r\n        var stringValue = Object.prototype.toString.call(value);\r\n        return (stringValue.toLowerCase() === \"[object array]\");\r\n    };\r\n    Collection.prototype = {\r\n        constructor: Collection,\r\n        init: function () {\r\n            // console.log('Collection.init', this);\r\n        },\r\n        add: function (value) {\r\n            if (Collection.isArray(value)) {\r\n                for (var i = 0 ; i < value.length ; i++) {\r\n                    // Add the sub-item using default push() method.\r\n                    Array.prototype.push.call(this, value[i]);\r\n                }\r\n            } else {\r\n                // Use the default push() method.\r\n                Array.prototype.push.call(this, value);\r\n            }\r\n            // Return this object reference for method chaining.\r\n            return (this);\r\n        },\r\n        addAll: function () {\r\n            // Loop over all the arguments to add them to the\r\n            // collection individually.\r\n            for (var i = 0 ; i < arguments.length ; i++) {\r\n                this.add(arguments[i]);\r\n            }\r\n            // Return this object reference for method chaining.\r\n            return (this);\r\n        }\r\n    };\r\n    return (Collection);\r\n}]);\r\n\r\napp.factory('Point', ['Base', function(Base){\r\n    var Point = Base.extend({\r\n        constructor: function Point(x, y, radius) {\r\n            this.x          = x || 0;\r\n            this.y          = y || 0;\r\n            this.radius     = radius || 100;        \r\n        }, \r\n        methods: {\r\n            move: function (degree, w, h, pow) {   \r\n                var radius = this.radius * (1 + pow);\r\n                this.x = w / 2 + radius * Math.sin(degree);\r\n                this.y = h / 2 + radius * Math.cos(degree);\r\n            },            \r\n            draw: function(ctx) {   \r\n                ctx.fillStyle = \"white\";\r\n                ctx.fillRect(this.x, this.y, 4, 4);\r\n            },\r\n        }\r\n    });\r\n    /*\r\n    function Point(x, y, radius) {\r\n        this.x =        x || 0;\r\n        this.y =        y || 0;\r\n        this.radius =   radius || 100;\r\n    }\r\n    Point.prototype = {\r\n        move = function(degree, w, h, pow) {\r\n            var radius = this.radius * (1 + pow);\r\n            this.x = w / 2 + radius * Math.sin(degree);\r\n            this.y = h / 2 + radius * Math.cos(degree);\r\n        },\r\n        draw: function(ctx) {            \r\n            ctx.fillStyle = \"white\";\r\n            ctx.fillRect(this.x, this.y, 4, 4);\r\n        },\r\n    }\r\n    */\r\n    return Point;\r\n}]);\r\n\r\napp.factory('Icon', ['Point', function(Point) {    \r\n    var Icon = Point.extend({\r\n        constructor: function Icon(x, y, radius, size) {\r\n            this.$ctor(x, y); // qui chiamo il constructor della classe Point\r\n            this.size           = size || 64;\r\n            this.forcex         = 0;\r\n            this.forcey         = 0;\r\n            this.prevx          = 0;\r\n            this.prevy          = 0;\r\n            this.image          = new Image();                \r\n            this.loadIcon();        \r\n        }, \r\n        methods: {\r\n            loadIcon: function() {\r\n                var _this = this;\r\n                this.image.onload = function() {\r\n                    _this.image.loaded = true;\r\n                }\r\n                this.image.loaded = false;\r\n                this.image.src = 'img/food-' + Math.floor(Math.random() * 15) + '.png';\r\n            },\r\n            repel: function (x, y, mouse) {\r\n                if (!mouse) {\r\n                    return;\r\n                }\r\n                var magnet = 400;\r\n                var distance = mouse.distance({ x: this.prevx, y: this.prevy });\r\n                var distancex = mouse.x - this.prevx;\r\n                var distancey = mouse.y - this.prevy;\r\n                var powerx = x - (distancex / distance) * magnet / distance;\r\n                var powery = y - (distancey / distance) * magnet / distance;            \r\n                this.forcex = (this.forcex + (this.prevx - x) / 2) / 2.1;\r\n                this.forcey = (this.forcey + (this.prevy - y) / 2) / 2.1;\r\n                this.x = powerx + this.forcex;\r\n                this.y = powery + this.forcey;\r\n            },\r\n            move: function (degree, w, h, pow, mouse) {   \r\n                this.$super.move(this, degree, w, h, pow); // qui chiamo il metodo \"move\" della classe Point\r\n                this.repel(this.x, this.y, mouse);\r\n            },   \r\n            draw: function(ctx, degree, w, h, pow, mouse) {\r\n                // this.$super.draw(this, ctx); // qui chiamo il metodo \"draw\" della classe Point                \r\n                if (this.image.loaded) {\r\n                    ctx.drawImage(this.image, this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);\r\n                };\r\n                this.prevx = this.x;\r\n                this.prevy = this.y;\r\n            },\r\n        }\r\n    });\r\n    /*\r\n    function Icon(x, y, radius, size) {\r\n        this.x =        x || 0;\r\n        this.y =        y || 0;\r\n        this.radius =   radius || 100;\r\n        this.size =     size || 64;\r\n        this.forcex =   0;\r\n        this.forcey =   0;\r\n        this.image =    new Image();\r\n        this.loaded =   false;            \r\n        this.init();        \r\n    }    \r\n    Icon.prototype = {\r\n        init: function() {\r\n            var _this = this;\r\n            this.image.onload = function() {\r\n                _this.loaded = true;\r\n            }\r\n            this.image.src = 'img/food-' + Math.floor(Math.random() * 15) + '.png';\r\n        },\r\n        repel: function (x, y, mouse) {\r\n            if (!mouse) {\r\n                this.x = x;\r\n                this.y = y;\r\n                return;\r\n            }\r\n            var magnet = 400;\r\n            var distance = mouse.distance(this);\r\n            var distancex = mouse.x - this.x;\r\n            var distancey = mouse.y - this.y;\r\n            var powerx = x - (distancex / distance) * magnet / distance;\r\n            var powery = y - (distancey / distance) * magnet / distance;            \r\n            this.forcex = (this.forcex + (this.x - x) / 2) / 2.1;\r\n            this.forcey = (this.forcey + (this.y - y) / 2) / 2.1;\r\n            this.x = powerx + this.forcex;\r\n            this.y = powery + this.forcey;\r\n        },\r\n        move: function(degree, w, h, pow, mouse) {\r\n            var radius = this.radius * (1 + pow);\r\n            var x = w / 2 + radius * Math.sin(degree);\r\n            var y = h / 2 + radius * Math.cos(degree);\r\n            this.repel(x, y, mouse);            \r\n        },\r\n        draw: function(ctx) {\r\n            if (this.loaded) {\r\n                ctx.drawImage(this.image, this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);\r\n            };\r\n        },\r\n    }\r\n    */\r\n    return Icon;\r\n}]);\r\n\r\napp.factory('Animate', [function() {\r\n    function Animate(callback) {\r\n        this.callback = callback;\r\n        this.key = null;\r\n        this.ticks = 0;        \r\n    }\r\n    Animate.prototype = {\r\n        play: function() {\r\n            var _this = this;\r\n            function loop(time) {\r\n                _this.ticks ++;\r\n                _this.callback(time, _this.ticks);\r\n                _this.key = window.requestAnimationFrame(loop);\r\n            }\r\n            if (!this.key) {\r\n                loop();\r\n            }\r\n        },\r\n        pause: function() {\r\n            if (this.key) {\r\n                window.cancelAnimationFrame(this.key);\r\n                this.key = null;\r\n            }\r\n        },\r\n        playpause: function() {\r\n            if (this.key) {\r\n                this.pause();\r\n            } else {\r\n                this.play();\r\n            }\r\n        }\r\n    }\r\n    return Animate;\r\n}]);\r\n\r\napp.value('UserRoles', [{\r\n    name: 'Guest', id: 1\r\n}, {\r\n    name: 'User', id: 2\r\n}, {\r\n    name: 'Supervisor', id: 3\r\n}, {\r\n    name: 'Admin', id: 4\r\n}]);\r\n\r\napp.value('UserRolesEnum', {\r\n    'Guest': 1,\r\n    'User': 2,\r\n    'Supervisor': 3,\r\n    'Admin': 4,\r\n});\r\n\r\napp.factory('User', ['UserRolesEnum', function (UserRolesEnum) {\r\n    function User(data) {\r\n        // Extend instance with data\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    User.prototype = {\r\n        // If user instance is in role Administrator\r\n        isAdmin: function () {\r\n            return this.role === UserRolesEnum.Admin;\r\n        },\r\n        // If user parameters equals user instance\r\n        isUser: function (user) {\r\n            return this.email === user.email;\r\n        },\r\n        picture: function (size) {\r\n          size = size || 'sm';\r\n          var w;\r\n          switch(size) {\r\n              case 'sm':\r\n                w = 50;\r\n              break;\r\n              case 'md':\r\n                w = 300;\r\n              break;\r\n              default:\r\n          }\r\n          return this.facebookId ? 'https://graph.facebook.com/'+ this.facebookId +'/picture?width=' + w + '&height=' + w + '&type=square' : '/img/avatar-default.png';\r\n        },\r\n        backgroundPicture: function(size) {\r\n            return 'background-image: url(' + this.picture(size) + ');';\r\n        },\r\n    };\r\n    return User;\r\n}]);\r\n\r\napp.factory('Post', ['$q', '$http', '$timeout', 'APP', 'User', 'Dish', 'Upload', function($q, $http, $timeout, APP, User, Dish, Upload) {\r\n\tfunction Post(data) {\r\n        data ? angular.extend(this, data) : null;\r\n        this.user = new User(this.user);\r\n        this.dish = new Dish(this.dish);\r\n    }\r\n    Post.prototype = {\r\n\t\tupload: function(file) {\r\n            console.log('Post.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function (response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function (response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function (event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Post;\r\n}]);\r\n\r\napp.factory('Dish', ['$q', '$http', '$timeout', 'APP', 'User', 'Upload', function($q, $http, $timeout, APP, User, Upload) {\r\n\tfunction Dish(data) {\r\n        this.extend(data);\r\n    }\r\n    Dish.prototype = {\r\n        extend: function(data) {\r\n            data ? angular.extend(this, data) : null;\r\n            this.user = new User(this.user);\r\n            if (this.votes) {\r\n                angular.forEach(this.votes, function(vote) {\r\n                    vote.user = new User(vote.user);\r\n                });\r\n            }\r\n        },\r\n\t\tlike: function(like) {\r\n            var self = this;\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/vote', { dishId: this.id, like: like }).then(function success(response) {\r\n                self.extend(response.data);\r\n                deferred.resolve(response);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n\t\t},\r\n\t\tupload: function(file) {\r\n            console.log('Dish.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function success(response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function error(response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function progress(event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Dish;\r\n}]);\r\n\n/*global angular,FB */\r\n\n/*global angular,FB */\r\n\r\napp.factory('FacebookService', ['$q', 'APP', function ($q, APP) {\r\n    function FacebookService() {\r\n    }\r\n    FacebookService.FB = function () {\r\n        var deferred = $q.defer();\r\n        if (window['FB'] !== undefined) {\r\n            deferred.resolve(window['FB']);\r\n        } else {\r\n            FacebookService.init().then(function (success) {\r\n                deferred.resolve(window['FB']);\r\n            }, function (error) {\r\n                deferred.reject(error);\r\n            })\r\n        }\r\n        return deferred.promise;\r\n    };\r\n    FacebookService.getFacebookMe = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me', { fields: 'id,name,first_name,last_name,email,gender,picture,cover,link' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    FacebookService.getPictureMe = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me/picture', { width: 300, height: 300, type: 'square' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    FacebookService.getLoginStatus = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.getLoginStatus(function (response) {\r\n                onFacebookStatus(response, deferred);\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    FacebookService.login = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.login(function (response) {\r\n                onFacebookStatus(response, deferred);\r\n            }, {\r\n                scope: 'public_profile,email' // publish_stream,\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    FacebookService.logout = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n\t\t\tfacebook.logout(function (response) {\r\n\t\t\t\tdeferred.resolve(response);\r\n\t\t\t});\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    FacebookService.deletePermissions = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n\t\t\tfacebook.api('/me/permissions', 'delete', function (response) {\r\n\t\t\t\tdeferred.resolve(response);\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    FacebookService.init = function () {\r\n        var deferred = $q.defer();\r\n        window.fbAsyncInit = function () {\r\n            FB.init({\r\n                appId: APP.FACEBOOK_APP_ID,\r\n                status: true,\r\n                cookie: true,\r\n                xfbml: true,\r\n                version: 'v2.5'\r\n            });\r\n            deferred.resolve(FB);\r\n        };\r\n        try {\r\n            (function (d, s, id) {\r\n                var js, fjs = d.getElementsByTagName(s)[0];\r\n                if (d.getElementById(id)) { return; }\r\n                js = d.createElement(s); js.id = id;\r\n                js.src = \"//connect.facebook.net/en_US/sdk.js\";\r\n                fjs.parentNode.insertBefore(js, fjs);\r\n            }(document, 'script', 'facebook-jssdk'));\r\n        } catch (e) {\r\n            deferred.reject(e);\r\n        }\r\n        return deferred.promise;\r\n    };\r\n    function onFacebookStatus(response, deferred) {\r\n        FacebookService.authResponse = null;\r\n        if (response.status === 'connected') {\r\n            FacebookService.authResponse = response.authResponse;\r\n            deferred.resolve(response);\r\n        } else if (response.status === 'not_authorized') {\r\n            deferred.reject(response);\r\n        } else {\r\n            deferred.reject(response);\r\n        }\r\n    };\r\n    return FacebookService;\r\n}]);\r\n\r\napp.factory('Users', ['$q', '$http', '$location', '$timeout', 'APP', 'LocalStorage', 'User', function ($q, $http, $location, $timeout, APP, LocalStorage, User) {\r\n    // PRIVATE VARIABLE FOR CURRENT USER\r\n    var _currentUser = null;\r\n    function Users() {\r\n    }\r\n    // INSTANCE METHODS\r\n    Users.prototype = {\r\n    };\r\n    // STATIC CLASS METHODS\r\n    Users.currentUser = function () {\r\n        return _currentUser;\r\n    };\r\n    Users.getCurrentUser = function () {\r\n        var deferred = $q.defer();\r\n        if (_currentUser) {\r\n            deferred.resolve(_currentUser);\r\n        } else {\r\n            $http.get(APP.API + '/api/users/current/').then(function success(response) {\r\n                if (response && response.data) {\r\n                    _currentUser = new User(response.data);\r\n                    deferred.resolve(_currentUser);\r\n                } else {\r\n                    deferred.resolve(null); // deferred.reject(null);\r\n                }\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n        }\r\n        return deferred.promise;\r\n    };\r\n    Users.isLogged = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            user && user.isAuthenticated ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n    Users.isAdmin = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            user && user.isAuthenticated && user.isAdmin ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n    Users.isLoggedOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n    Users.isAdminOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated && user.isAdmin) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n    /** LOGIN METHODS **/\r\n    Users.signup = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signup/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    Users.signin = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signin/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    Users.signInWithFacebook = function (auth) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signinwithfacebook/', auth).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    Users.signout = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/signout/').then(function success(response) {\r\n            _currentUser = null;\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    Users.detail = function (userRoute) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/route/' + userRoute).then(function success(response) {\r\n            deferred.resolve(new User(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    return Users;\r\n}]);\r\n\r\napp.factory('Categories', ['$http', '$q', 'APP', function ($http, $q, APP) {\r\n    function Categories() {\r\n    }\r\n    Categories.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/').then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    Categories.detail = function (categoryId) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/' + categoryId).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    return Categories;\r\n}]);\r\n\r\napp.factory('Posts', ['$http', '$q', 'APP', 'Post', function ($http, $q, APP, Post) {\r\n    function Posts() {\r\n    }\r\n    Posts.uri = {\r\n        paging: APP.API + '/api/stream/paged',\r\n    };\r\n    Posts.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Post(item));\r\n        }, rows);\r\n    };\r\n    Posts.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/post/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    return Posts;\r\n}]);\r\n\r\napp.factory('Dishes', ['$http', '$q', 'APP', 'Dish', function ($http, $q, APP, Dish) {\r\n    function Dishes() {\r\n    }\r\n    Dishes.uri = {\r\n        paging: APP.API + '/api/dishes/paged',\r\n    };\r\n    Dishes.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n    Dishes.detail = function (id) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/' + id).then(function success(response) {\r\n            deferred.resolve(new Dish(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    Dishes.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/dishes/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    Dishes.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/').then(function success(response) {\r\n            var rows = [];\r\n            angular.forEach(response.data, function (item) {\r\n                this.push(new Dish(item));\r\n            }, rows);\r\n            deferred.resolve(rows);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    return Dishes;\r\n}]);\r\n\r\napp.factory('DishesTest', ['APP', 'Dish', function (APP, Dish) {\r\n    var uniqueId = 100;\r\n    function getRandomItems() {\r\n        var items = [];\r\n        while (items.length < 10) {\r\n            items.push({\r\n                id: uniqueId,\r\n                name: 'dish ' + uniqueId,\r\n                price: 3.20,\r\n                yes: Math.floor(Math.random() * 999),\r\n                no: Math.floor(Math.random() * 999),\r\n                pictures: [{\r\n                    route: 'http://lorempixel.com/750/375/food/' + (1 + uniqueId % 10), // 'http://placehold.it/750x375',\r\n                }],\r\n                user: {\r\n                    userName: 'User',\r\n                }\r\n            });\r\n            uniqueId++;\r\n        }\r\n        return items;\r\n    }\r\n    function TestSource() {\r\n    }\r\n    TestSource.uri = {\r\n        paging: false,\r\n    };\r\n    TestSource.resolve = function (rows) {\r\n        var items = getRandomItems();\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n    return TestSource;\r\n}]);\r\n\r\napp.factory('DishesAutocomplete', ['$q', '$http', '$timeout', 'APP', function ($q, $http, $timeout, APP) {\r\n    var MAX_ITEMS = 5;\r\n    function DishesAutocomplete() {\r\n    }\r\n    DishesAutocomplete.prototype = {\r\n        setPhrase: function (phrase) {\r\n            // console.log('DishesAutocomplete.setPhrase', phrase);\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/autocomplete', { phrase: phrase }).then(function success(response) {\r\n                var data = {\r\n                    items: [],\r\n                    count: response.data.length,\r\n                };\r\n                angular.forEach(response.data, function (v, i) {\r\n                    if (i < MAX_ITEMS) {\r\n                        var value = {\r\n                            id: v.id,\r\n                            name: v.name,\r\n                        };\r\n                        var offset = v.name.toLowerCase().indexOf(phrase.toLowerCase());\r\n                        var length = phrase.length;\r\n                        value.NameA = value.name.substr(0, offset);\r\n                        value.NameB = value.name.substr(offset, length);\r\n                        value.NameC = value.name.substr(offset + length, value.name.length - (offset + length));\r\n                        data.items.push(value);\r\n                    }\r\n                });\r\n                deferred.resolve(data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n        setItem: function (item) {\r\n            var deferred = $q.defer();\r\n            $http.get(APP.API + '/api/dishes/' + item.id).then(function success(response) {\r\n                console.log('autoComplete.setItem', response.data);\r\n                deferred.resolve(response.data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    return DishesAutocomplete;\r\n}]);\r\n\r\napp.factory('DataFilter', [function () {\r\n    function DataFilter(data) {\r\n        /*\r\n        this.dateFrom = null;\r\n        this.dateTo = null;\r\n        this.search = null;\r\n        this.status = null;\r\n        */\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    DataFilter.prototype = {\r\n        getSearchParams: function (search) {\r\n            var a = [];\r\n            if (search) {\r\n                for (var p in search) {\r\n                    a.push({ name: p, value: search[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source, infinite) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                if (p === 'dateFrom' ||\r\n                    p === 'dateTo' ||\r\n                    p === 'status') {\r\n                    value = this[p];\r\n                    if (value !== undefined) {\r\n                        post[p] = value;\r\n                    }\r\n                } else if (p === 'search') {\r\n                    post[p] = JSON.stringify(this.getSearchParams(this[p]), null, '');\r\n                }\r\n            }\r\n            post.page = source.page;\r\n            post.size = source.size;\r\n            post.infinite = infinite;\r\n            return post;\r\n        },\r\n    };\r\n    return DataFilter;\r\n}]);\r\n\r\napp.factory('DataSource', ['$q', '$http', '$httpAsync', '$timeout', '$rootScope', 'DataFilter', function ($q, $http, $httpAsync, $timeout, $rootScope, DataFilter) {\r\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\r\n    function DataSource(data) {\r\n        this.busy = false;\r\n        this.error = false;\r\n        this.size = 10;\r\n        this.maxPages = 10;\r\n        this.rows = [];\r\n        this.filters = {};\r\n        this.service = {\r\n            url: '/api/items/paging',\r\n            resolve: function (items, rows) {\r\n                angular.forEach(items, function (item) {\r\n                    this.push(item);\r\n                }, rows);\r\n            },\r\n        };\r\n        data ? angular.extend(this, data) : null;\r\n        this.filters = new DataFilter(this.filters);\r\n        // FAKE SERVICE FOR TEST !!!\r\n        if (this.service.uri.paging === false) {\r\n            this.get = function (deferred, infinite) {\r\n                this.busy = true;\r\n                this.error = false;\r\n                $timeout(function () {\r\n                    infinite ? null : this.rows.length = 0;\r\n                    this.service.resolve(this.rows);\r\n                    this.page = 1;\r\n                    this.pages = 2;\r\n                    this.count = this.rows.length;\r\n                    this.pagination = this.getPages();\r\n                    this.busy = false;\r\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                    deferred.resolve(this.rows);\r\n                    // console.log('DataSource.get');\r\n                }.bind(this), 1000);\r\n            };\r\n        }\r\n        this.flush();\r\n    }\r\n    DataSource.prototype = {\r\n        flush: function () {\r\n            this.pages = PAGES_MAX;\r\n            this.page = 1;\r\n            this.count = 0;\r\n            this.opened = null;\r\n        },\r\n        resolve: function (response) {\r\n            var responseHeader = response.headers('X-Pagination');\r\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\r\n            // console.log('response', response, 'responseHeader', responseHeader, 'responseView', responseView);\r\n            if (responseView) {\r\n                this.page = responseView.page;\r\n                this.size = responseView.size;\r\n                this.pages = responseView.pages;\r\n                this.count = responseView.count;\r\n            } else {\r\n                this.page = 0;\r\n                this.size = responseView.size;\r\n                this.pages = 0;\r\n                this.count = 0;\r\n            }\r\n            this.pagination = this.getPages();\r\n        },\r\n        get: function (deferred, infinite) {\r\n            this.busy = true;\r\n            this.error = false;\r\n            $http.get(this.service.uri.paging, { params: this.filters.getParams(this) }).then(function success(response) { // $httpAsync\r\n                this.resolve(response);\r\n                infinite ? null : this.rows.length = 0;\r\n                this.service.resolve(response.data, this.rows);\r\n                $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                deferred.resolve(this.rows);\r\n            }.bind(this), function error(response) {\r\n                console.log('error.response', response);\r\n                this.error = true;\r\n                deferred.reject(response);\r\n            }.bind(this))\r\n                .finally(function () {\r\n                    // console.log('DataSource.get');\r\n                    $timeout(function () {\r\n                        this.busy = false;\r\n                    }.bind(this), 1000);\r\n                }.bind(this));\r\n        },\r\n        paging: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.paging');\r\n                this.opened = null;\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        refresh: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.refresh');\r\n                this.flush();\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        more: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page + 1 > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.more');\r\n                this.page++;\r\n                this.get(deferred, true);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        filter: function () {\r\n            this.page = 1;\r\n            this.pages = PAGES_MAX;\r\n            this.paging();\r\n        },\r\n        prevPage: function () {\r\n            var page = this.page - 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        nextPage: function () {\r\n            var page = this.page + 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        gotoPage: function (page) {\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        firstPage: function () {\r\n            if (this.page !== 1) {\r\n                this.page = 1;\r\n                this.paging();\r\n            }\r\n        },\r\n        lastPage: function () {\r\n            if (this.page !== this.pages) {\r\n                this.page = this.pages;\r\n                this.paging();\r\n            }\r\n        },\r\n        hasMany: function () {\r\n            return this.count > 0 && this.pages > this.maxPages;\r\n        },\r\n        hasMorePagesBehind: function () {\r\n            var startingIndex = Math.max(0, this.page - this.maxPages);\r\n            return startingIndex > 0;\r\n        },\r\n        hasMorePagesNext: function () {\r\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\r\n            return endingIndex < this.pages;\r\n        },\r\n        isPage: function (number) {\r\n            return this.page === number;\r\n        },\r\n        hasPages: function () {\r\n            return this.pages > 0 && this.pages < PAGES_MAX;\r\n        },\r\n        getPages: function () {\r\n            var a = [], i;\r\n            if (this.hasPages()) {\r\n                var startingIndex = Math.max(0, this.page - this.maxPages);\r\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\r\n                i = startingIndex;\r\n                while (i < endingIndex) {\r\n                    a.push({ number: (i + 1) });\r\n                    i++;\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        openClose: function (index) {\r\n            if (this.opened === index) {\r\n                this.opened = null;\r\n            } else {\r\n                this.opened = index;\r\n            }\r\n        }\r\n    };\r\n    return DataSource;\r\n}]);\r\n\r\napp.factory('Cookie', ['$q', '$window', function ($q, $window) {\r\n    function Cookie() {\r\n    }\r\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\r\n    Cookie._set = function (name, value, days) {\r\n        if (days) {\r\n            var date = new Date();\r\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n            var expires = \"; expires=\" + date.toGMTString();\r\n        } else {\r\n            var expires = \"\";\r\n        }\r\n        $window.document.cookie = name + \"=\" + value + expires + \"; path=/\";\r\n    }\r\n    Cookie.set = function (name, value, days) {\r\n        try {\r\n            var cache = [];\r\n            var json = JSON.stringify(value, function (key, value) {\r\n                if (key === 'pool') {\r\n                    return;\r\n                }\r\n                if (typeof value === 'object' && value !== null) {\r\n                    if (cache.indexOf(value) !== -1) {\r\n                        // Circular reference found, discard key\r\n                        return;\r\n                    }\r\n                    cache.push(value);\r\n                }\r\n                return value;\r\n            });\r\n            cache = null;\r\n            Cookie._set(name, json, days);\r\n        } catch (e) {\r\n            console.log('Cookie.set.error serializing', name, value, e);\r\n        }\r\n    };\r\n    Cookie.get = function (name) {\r\n        var cookieName = name + \"=\";\r\n        var ca = $window.document.cookie.split(';');\r\n        for (var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) == ' ') {\r\n                c = c.substring(1, c.length);\r\n            }\r\n            if (c.indexOf(cookieName) == 0) {\r\n                var value = c.substring(cookieName.length, c.length);\r\n                var data = null;\r\n                try {\r\n                    data = JSON.parse(value);\r\n                } catch (e) {\r\n                    console.log('Cookie.get.error parsing', key, e);\r\n                };\r\n                return data;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    Cookie.delete = function (name) {\r\n        Cookie._set(name, \"\", -1);\r\n    };\r\n    Cookie.on = function (name) {\r\n        var deferred = $q.defer();\r\n        var i, interval = 1000, elapsed = 0, timeout = Cookie.TIMEOUT;\r\n        function checkCookie() {\r\n            if (elapsed > timeout) {\r\n                deferred.reject('timeout');\r\n            } else {\r\n                var c = Cookie.get(name);\r\n                if (c) {\r\n                    deferred.resolve(c);\r\n                } else {\r\n                    elapsed += interval;\r\n                    i = setTimeout(checkCookie, interval);\r\n                }\r\n            }\r\n        }\r\n        checkCookie();\r\n        return deferred.promise;\r\n    };\r\n    return Cookie;\r\n}]);\r\n\r\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\r\n    function LocalStorage() {\r\n    }\r\n    function isLocalStorageSupported() {\r\n        var supported = false;\r\n        try {\r\n            supported = 'localStorage' in $window && $window['localStorage'] !== null;\r\n            if (supported) {\r\n                $window.localStorage.setItem('test', '1');\r\n                $window.localStorage.removeItem('test');\r\n            } else {\r\n                supported = false;\r\n            }\r\n        } catch (e) {\r\n            supported = false;\r\n        }\r\n        return supported;\r\n    }\r\n    LocalStorage.isSupported = isLocalStorageSupported();\r\n    if (LocalStorage.isSupported) {\r\n        LocalStorage.set = function (name, value) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function (key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                $window.localStorage.setItem(name, json);\r\n            } catch (e) {\r\n                console.log('LocalStorage.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        LocalStorage.get = function (name) {\r\n            var value = null;\r\n            if ($window.localStorage[name] !== undefined) {\r\n                try {\r\n                    value = JSON.parse($window.localStorage[name]);\r\n                } catch (e) {\r\n                    console.log('LocalStorage.get.error parsing', name, e);\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        LocalStorage.delete = function (name) {\r\n            $window.localStorage.removeItem(name);\r\n        };\r\n        LocalStorage.on = function (name) {\r\n            var deferred = $q.defer();\r\n            var i, timeout = Cookie.TIMEOUT;\r\n            function storageEvent(e) {\r\n                // console.log('LocalStorage.on', name, e);\r\n                clearTimeout(i);\r\n                if (e.originalEvent.key == name) {\r\n                    try {\r\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                        deferred.resolve(value);\r\n                    } catch (e) {\r\n                        console.log('LocalStorage.on.error parsing', name, e);\r\n                        deferred.reject('error parsing ' + name);\r\n                    }\r\n                }\r\n            }\r\n            angular.element($window).on('storage', storageEvent);\r\n            i = setTimeout(function () {\r\n                deferred.reject('timeout');\r\n            }, timeout);\r\n            return deferred.promise;\r\n        };\r\n    } else {\r\n        console.log('LocalStorage.unsupported switching to cookies');\r\n        LocalStorage.set = Cookie.set;\r\n        LocalStorage.get = Cookie.get;\r\n        LocalStorage.delete = Cookie.delete;\r\n        LocalStorage.on = Cookie.on;\r\n    }\r\n    return LocalStorage;\r\n}]);\r\n\r\napp.factory('Vector', function() {\r\n\tfunction Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        distance: function (b) {\r\n            return Vector.distance(this, b);\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n});\r\n\r\napp.factory('Utils', ['Vector', function (Vector) {\r\n    (function () {\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };\r\n        }\r\n    }());\r\n\r\n    var transformProperty = function detectTransformProperty() {\r\n        var transformProperty = 'transform',\r\n            safariPropertyHack = 'webkitTransform';\r\n\t\tvar div = document.createElement(\"DIV\");\r\n        if (typeof div.style[transformProperty] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function(prefix) {\r\n                var e = '-' + prefix + '-transform';\r\n                if (typeof div.style[e] !== 'undefined') {\r\n                    transformProperty = e;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof div.style[safariPropertyHack] !== 'undefined') {\r\n            transformProperty = '-webkit-transform';\r\n        } else {\r\n            transformProperty = undefined;\r\n        }\r\n        return transformProperty;\r\n    } ();\r\n\r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left,  rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    var getNow = Date.now || function() {\r\n        return new Date().getTime();\r\n    };\r\n\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n\r\n    var Style = function() {\r\n        function Style() {\r\n            this.props = {\r\n                scale: 1,\r\n                hoverScale: 1,\r\n                currentScale: 1,\r\n            }\r\n        }\r\n        Style.prototype = {\r\n            set: function (element) {\r\n                var styles = [];\r\n                angular.forEach(this, function (value, key) {\r\n                    if (key !== 'props')\r\n                        styles.push(key + ':' + value);\r\n                });\r\n                element.style.cssText = styles.join(';') + ';';\r\n            },\r\n            transform: function (transform) {\r\n                this[Utils.transformProperty] = transform;\r\n            },\r\n            transformOrigin: function (x, y) {\r\n                this[Utils.transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n                this[Utils.transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n            },\r\n        };\r\n        return Style;\r\n    }();\r\n\r\n    function Utils() {\r\n    }\r\n\r\n\tUtils.transformProperty = transformProperty;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.throttle = throttle;\r\n    Utils.Style = Style;\r\n\r\n    return Utils;\r\n}]);\r\n\n/*global angular*/\r\n\r\napp.factory('WebWorker', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        window.Worker = function () {\r\n            function Worker(src) {\r\n                var self = this;\r\n                $http.get(src, { transformResponse: function (d, h) { return d } }).then(function success(response) {\r\n                    try {\r\n                        eval('self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\\n ' + response.data + ' };');\r\n                        self.object = new self.o();\r\n                        self.object.postMessage = function (e) {\r\n                            self.onmessage({data:e});\r\n                        }\r\n                    } catch(e) {\r\n                        console.log(\"Worker error \", e);\r\n                    }\r\n                }, function error(response) {\r\n                    console.log(\"Worker not found\");\r\n                });\r\n            }\r\n            Worker.prototype = {\r\n                onmessage: function (e) {\r\n                    console.log('Worker not implemented');\r\n                },\r\n                postMessage: function (e) {\r\n                    this.object.onmessage({ data: e });\r\n                }\r\n            }\r\n            return Worker;\r\n        } ();\r\n    }\r\n    function WebWorker(src) {\r\n        var self = this;\r\n        this.callbacks = {};\r\n        this.id = 0;\r\n        this.worker = new Worker(src);\r\n        this.worker.onmessage = function (e) {\r\n            self.onmessage(e);\r\n        };\r\n    }\r\n    WebWorker.prototype = {\r\n        parse: function (e) {\r\n            return JSON.parse(e.data);\r\n        },\r\n        stringify: function (data) {\r\n            return JSON.stringify(data);\r\n        },\r\n        onmessage: function (e) {\r\n            var data = this.parse(e);\r\n            var deferred = this.callbacks[data.id];\r\n            if (data.status !== -1) {\r\n                deferred.resolve(data);\r\n            } else {\r\n                deferred.reject(data);\r\n            }\r\n            delete this.callbacks[data.id];\r\n        },\r\n        post: function (data) {\r\n            var deferred = $q.defer();\r\n            data.id = this.id;\r\n            this.callbacks[this.id.toString()] = deferred;\r\n            this.id++;\r\n            this.worker.postMessage(this.stringify(data));\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    WebWorker.isSupported = isWebWorkerSupported;\r\n    return WebWorker;\r\n}]);\r\n\r\napp.factory('$httpAsync', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        return $http;\r\n    }\r\n    var worker = new Worker('/js/workers/http.js');\r\n    var callbacks = {};\r\n    var id = 0;\r\n    var lowercase = function (string) { return isString(string) ? string.toLowerCase() : string; };\r\n    var trim = function (value) {\r\n        return isString(value) ? value.trim() : value;\r\n    };\r\n    function $httpAsync(options) {\r\n        var deferred = $q.defer();\r\n        var wrap = getDefaults(options);\r\n        wrap.id = id.toString();\r\n        console.log('wrap', wrap);\r\n        callbacks[wrap.id] = deferred;\r\n        id++;\r\n        worker.postMessage($httpAsync.stringify(wrap));\r\n        return deferred.promise;\r\n    }\r\n    $httpAsync.get = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'GET',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.delete = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'DELETE',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.head = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'HEAD',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.post = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'POST',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.put = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PUT',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.patch = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PATCH',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.parse = function (e) {\r\n        return JSON.parse(e.data);\r\n    };\r\n    $httpAsync.stringify = function (data) {\r\n        return JSON.stringify(data);\r\n    };\r\n    $httpAsync.isSupported = isWebWorkerSupported;\r\n    worker.onmessage = function (e) {\r\n        var wrap = $httpAsync.parse(e);\r\n        console.log('onmessage', wrap);\r\n        var deferred = callbacks[wrap.id];\r\n        var status = wrap.status >= -1 ? wrap.status : 0;\r\n        var getter = headersGetter(wrap.response.headers);\r\n        (isSuccess(status) ? deferred.resolve : deferred.reject)({\r\n            data: wrap.response.data, // !!!! JSON.parse(wrap.response.data),\r\n            headers: getter,\r\n            status: wrap.response.status,\r\n            statusText: wrap.response.statusText,\r\n            config: wrap.config,\r\n        });\r\n        delete callbacks[wrap.id];\r\n    }\r\n    return $httpAsync;\r\n    function isSuccess(status) {\r\n        return 200 <= status && status < 300;\r\n    }\r\n    function createMap() {\r\n        return Object.create(null);\r\n    }\r\n    function isString(value) { return typeof value === 'string'; }\r\n    function parseHeaders(headers) {\r\n        var parsed = createMap(), i;\r\n        function fillInParsed(key, val) {\r\n            if (key) {\r\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\r\n            }\r\n        }\r\n        if (isString(headers)) {\r\n            var a = headers.split('\\n');\r\n            for (var j = 0; j < a.length; j++) {\r\n                var line = a[j];\r\n                i = line.indexOf(':');\r\n                fillInParsed(lowercase(trim(line.substr(0, i))), trim(line.substr(i + 1)));\r\n            }\r\n        } else if (isObject(headers)) {\r\n            for (var p in headers) {\r\n                fillInParsed(lowercase(p), trim(headers[p]));\r\n            }\r\n        }\r\n        return parsed;\r\n    }\r\n    function headersGetter(headers) {\r\n        var headersObj;\r\n        return function (name) {\r\n            if (!headersObj) headersObj = parseHeaders(headers);\r\n            if (name) {\r\n                var value = headersObj[lowercase(name)];\r\n                if (value === void 0) {\r\n                    value = null;\r\n                }\r\n                return value;\r\n            }\r\n            return headersObj;\r\n        };\r\n    }\r\n    function getDefaults(options) {\r\n        var defaults = {\r\n            method: 'GET',\r\n            withCredentials: false,\r\n            responseType: 'json',\r\n            headers: {},\r\n            config: {}\r\n        }\r\n        defaults.withCredentials = $http.defaults.withCredentials;\r\n        angular.extend(defaults.headers, $http.defaults.headers.common);\r\n        var method = (options.method || defaults.method).toLowerCase();\r\n        if ($http.defaults.headers[method]) {\r\n            angular.extend(defaults.headers, $http.defaults.headers[method]);\r\n        }\r\n        console.log('defaults', $http.defaults);\r\n        // defaults = angular.extend(defaults, $http.defaults);\r\n        /*\r\n    method{string}:                     HTTP method (e.g. 'GET', 'POST', etc)\r\n    url:{string}:                       Absolute or relative URL of the resource that is being requested.\r\n    params:{Object.<string|Object>}:    Map of strings or objects which will be serialized with the paramSerializer and appended as GET parameters.\r\n\r\n    data:{string|Object}:               Data to be sent as the request message data.\r\n    headers:{Object}:                   Map of strings or functions which return strings representing HTTP headers to send to the server. If the return value of a function is null, the header will not be sent. Functions accept a config object as an argument.\r\n\r\n    xsrfHeaderName:{string}:            Name of HTTP header to populate with the XSRF token.\r\n    xsrfCookieName:{string}:            Name of cookie containing the XSRF token.\r\n    transformRequest:{function(data, headersGetter)|Array.<function(data, headersGetter)>}:         transform function or an array of such functions. The transform function takes the http request body and headers and returns its transformed (typically serialized) version. See Overriding the Default Transformations\r\n\r\n    transformResponse:{function(data, headersGetter, status)|Array.<function(data, headersGetter, status)>}:    transform function or an array of such functions. The transform function takes the http response body, headers and status and returns its transformed (typically deserialized) version. See Overriding the Default TransformationjqLiks\r\n\r\n    paramSerializer:{string|function(Object<string,string>):string}:        A function used to prepare the string representation of request parameters (specified as an object). If specified as string, it is interpreted as function registered with the $injector, which means you can create your own serializer by registering it as a service. The default serializer is the $httpParamSerializer; alternatively, you can use the $httpParamSerializerJQLike\r\n\r\n    cache:{boolean|Cache}:              If true, a default $http cache will be used to cache the GET request, otherwise if a cache instance built with $cacheFactory, this cache will be used for caching.\r\n\r\n    timeout:{number|Promise}:           timeout in milliseconds, or promise that should abort the request when resolved.\r\n    withCredentials:{boolean}:          whether to set the withCredentials flag on the XHR object. See requests with credentials for more information.\r\n\r\n    responseType:{string}:              see XMLHttpRequest.responseType.\r\n        */\r\n        options ? options = angular.extend(defaults, options) : defaults;\r\n        return options;\r\n    }\r\n}]);\r\n"],"sourceRoot":"/source/"}